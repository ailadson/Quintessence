function Sludge(a,b){var c=this;this.engine=a,this.world=a.world,this.player=b,this.elements=[],this.alpha=.5,this.alphaTime=0,this.nTime=0,this.x=b.x,this.y=b.y,this.xOffset=this.x-this.world.x,this.yOffset=this.y-this.world.y,this.draw=function(a,b){if(c.x=this.world.x+this.xOffset,c.y=this.world.y+this.yOffset,b>c.alphaTime+200){if(c.alphaTime=b,0==c.alpha)return void c.destroy();c.alpha-=this.player.sludgeAlphaStep,c.alpha<0&&(c.alpha=0)}for(var d=0;d<c.elements.length;d++){var e=c.elements[d];b>c.nTime+50&&(d==c.elements.length-1&&(c.nTime=b),e.radius+=1),e.x=c.x+e.xOffset,e.y=c.y+e.yOffset,e.x>-(e.radius+3)&&e.x<a.width+e.radius+3&&e.y>-(e.radius+3)&&e.y<a.height+e.radius+3&&(a.ctx.beginPath(),c.engine.util.drawElement(e,a.ctx,function(a,b){var d="rgba("+b.rgb.r+","+b.rgb.g+","+b.rgb.b+","+c.alpha+")";return d}))}},this.destroy=function(){c.engine.removeEther(c)}}window.mobilecheck=function(){var a=!1;return function(b){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(b)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(b.substr(0,4)))&&(a=!0)}(navigator.userAgent||navigator.vendor||window.opera),a};var Ether=Ether||{};Ether.Element=function(a,b,c,d){var c=c||{};this.type=c.type||a,this.bad=d,c.rgb=c.rgb||{};var e=c.rgb.r||255*Math.random()>>0,f=c.rgb.g||255*Math.random()>>0,g=c.rgb.b||255*Math.random()>>0;switch(a){case"core":150>=e&&(e+=100),150>=f&&(f+=100),150>=g&&(g+=100);break;case"fire":e=255,f>=125&&(f=75),g>=100&&(g=50);break;case"water":g=255,e>=75&&(e=50),f>=175&&(f-=100);break;case"air":185>=e&&(e=230),185>=f&&(f=230),g=255;break;case"earth":g=0,(e>200||100>e)&&(e=150),(f>175||120>f)&&(f=150)}this.color="rgba("+e+","+f+","+g+",0.5)",this.rgb={r:e,g:f,b:g};var h=b||.5;if(this.radius=c.radius,!this.radius)switch(a){case"core":this.radius=15*Math.random()+5*h;default:this.radius=15*Math.random()+5*h}this.vx=10*Math.random()-5,this.vy=10*Math.random()-5,this.x,this.y,this.xOffset=c.xOffset,this.yOffset=c.yOffset,this.jitter=d?-5:-1},Ether.awards={},Ether.awards.consciousness=[{text:"I"},{text:"I am"},{text:"Me"},{text:"Mine"},{text:"You"},{text:"I love"},{text:"I am sleepy"},{text:"I am hot"},{text:"I am cold"},{text:"I am thirsty"},{text:"I am hungry"},{text:"I am horny"},{text:"I am in the world"},{text:"I want this"},{text:"Why can't I have that?"},{text:"I'm afraid"},{text:"Why do I hurt?"},{text:"How do I get more?"},{text:"Who are my friends?"},{text:"How can I thrive?"},{text:"This is my stuff"},{text:"I am right"},{text:"They are wrong"},{text:"I will create"},{text:"Will I die?"},{text:"Everything dies"},{text:"Why am I here?"},{text:"I will die"},{text:"Who am I?"},{text:"Where did I come from?"},{text:"This is the truth"},{text:"That is not the truth"},{text:"This is who I am"},{text:"Who I am keeps changing"},{text:"I am my thougts"},{text:"My thoughts always change"},{text:"Do I change?"},{text:"What is constant?"},{text:"I am awareness"},{text:"Was awareness always here?"},{text:"From here did this awareness come?"},{text:"All comes from nothing"},{text:"All goes to nothing"},{text:"I am all"},{text:"I am nothing"},{text:"I am self evident"},{text:"I am self here"},{text:"No word is true"},{text:"How can sounds describe silence?"},{text:"[silence]"}],Ether.awards.matter=[{text:"Strings(1 x 10^-35)"},{text:"Quantum Foam(1 x 10^-35)"},{text:"Neutrinos(1 x 10^-24)"},{text:"Quarks(1 x 10^-19)"},{text:"Protons(1 x 10^-15)"},{text:"Neutrons(1 x 10^-15)"},{text:"Electrons(1 x 10^-15)"},{text:"Rays(1 x 10^-12)"},{text:"Atoms(1 x 10^-10)"},{text:"Proteins(1 x 10^-10)"},{text:"Molecules(1 x 10^-9)"},{text:"Clay Particles(1 x 10^-6)"},{text:"Mist Droplets(1 x 10^-5)"},{text:"Viruses(1 x 10^-8)"},{text:"Large Rocks(5 x 10^3)"},{text:"Moons(1.5 x 10^5)"},{text:"Bacteria(1 x 10^-3)"},{text:"Planets(1.27 x 10^7)"},{text:"Nebula(8^10 x 16)"},{text:"Protozoa(1 x 10^-5)"},{text:"Choanoflagellate(7 x 10^-6)"},{text:"Stars(5.8 x 10^9)"},{text:"Galaxies(1.2 x 10^21)"},{text:"Clusters(3 x 10^23)"},{text:"Chromistas(1 x 10^-1)"},{text:"Fungi(7 x 10^3)"},{text:"Invertebrates(4 x 10-2)"},{text:"Plants(1.5 x 10^1)"},{text:"Vertebrates(1 x 10^-1)"},{text:"Land Animals(3 x 10^0)"},{text:"Intelligence(1.7 x 10^0)"},{text:"Symbolic Systems(1.7 x 10^0)"},{text:"Mechanical Systems(1.5 x 10^1)"},{text:"Digital Systems(3.2 x 10^-8)"},{text:"Bioengineered Systems(1.7 x 10^0)"},{text:"Quantum Systems(1 x 10^-10)"},{text:"Artifical Intelligence(3.2 x 10^-8)"},{text:"Planetary Societies(1.27 x 10^7)"},{text:"Synchronized Mind(1.7 x x10^0)"},{text:"Solar Societies(1.2 x 10^10)"},{text:"Giant Stars(8 x 10^11)"},{text:"Dwarf Stars(1.27 x 10^7)"},{text:"String Computing(1 x 10^-35)"},{text:"Neutron Stars(1.3 x 10^4)"},{text:"Supernovas(9.5 x 10^16)"},{text:"Galactic Societies(1.2 x 10^21)"},{text:"Multi-Demensional Computing(~)"},{text:"Black Holes"},{text:"Thermal Equilibrium"},{text:"[silence]"}],Ether.Util=function(a){this.engine=a},Ether.Util.prototype.degToRad=function(a){return Ether.Util.radianInDeg*a},Ether.Util.prototype.radToDeg=function(a){return Ether.Util.degreeInRad*a},Ether.Util.radianInDeg=180/Math.PI,Ether.Util.degreeInRad=Math.PI/180,Ether.Util.prototype.getDistanceFromCenter=function(a,b){var c=b.x-Math.abs(a.x),d=b.y-Math.abs(a.y);return Math.sqrt(c*c+d*d)},Ether.Util.prototype.createGradient=function(a,b){for(var c=0;c<b.length;c++){var d=b[c];a.addColorStop(d[0],d[1])}return a},Ether.Util.prototype.drawElement=function(a,b,c){var d=c(b,a);b.fillStyle=d,b.arc(a.x,a.y,a.radius,2*Math.PI,!1),b.fill()},Ether.Ether=function(a){this.engine=a,this.util=a.util,this.rotateLastTime=0,this.coreElements=[],this.elements=[],this.moved,this.x=a.width/2,this.y=a.height/2,this.xv,this.yv,this.range=15,this.mass=1,this.age=0,this.speed=8,this.health=5e3,this.lifeSpan=[20,95,90,70],this.currentSpan=this.lifeSpan[this.age],this.totalLifeSpan,this.dead=!1,this.ageLastTime=0,this.finalElementLength=1,this.stabilityLastTime=0,this.transformation,this.transformations=[this.rotateElement,this.createSludge],this.sludgeTimeOffset=500,this.sludgeAlphaStep=.1,this.sludgeLastTime=0,this.rotateLastTime=0,this.rotateDirection=-1,this.degreeChange=0},Ether.Ether.prototype.init=function(){switch(this.age){case 0:this.createCoreElement();break;case 1:case 2:this.zoomOut(2);break;case 3:this.zoomOut(2),this.sludgeAlphaStep*=2,this.sludgeTimeOffset*=4,this.finalElementLength=this.elements.length}},Ether.Ether.prototype.draw=function(a,b){this.drawCoreElements(a),this.drawElements(a,b),this.stabilityCheck(a,b)},Ether.Ether.prototype.drawElements=function(a,b){var c=this;3==this.age&&this.ageEther(b);for(var d=0;d<this.elements.length;d++){var e=this.elements[d];e.x=this.x+e.xOffset+e.jitter*(this.getStability()/10),e.y=this.y+e.yOffset,e.jitter*=-1,this.age>=2&&this.transformation(e,b),a.ctx.beginPath(),c.util.drawElement(e,a.ctx,function(b,d){var e=a.ctx.createRadialGradient(d.x,d.y,0,d.x,d.y,d.radius);return c.util.createGradient(e,[[.1,"white"],[.1,"white"],[.8,d.color],[.1,"black"]])})}2==this.age&&b>this.rotateLastTime+500&&(this.rotateLastTime=b)},Ether.Ether.prototype.drawCoreElements=function(a){var b=this;a.ctx.globalCompositeOperation="lighter";for(var c=0;c<this.coreElements.length;c++){var d=this.coreElements[c];a.ctx.beginPath(),0==this.age?b.util.drawElement(d,a.ctx,function(a,c){var d=a.createRadialGradient(c.x,c.y,0,c.x,c.y,c.radius);return b.util.createGradient(d,[[.5,"white"],[1,"black"]])}):b.util.drawElement(d,a.ctx,function(a,c){var d=a.createRadialGradient(c.x,c.y,0,c.x,c.y,c.radius);return b.util.createGradient(d,[[.5,"white"],[.4,c.color],[1,"black"]])}),d.x+=d.vx,d.y+=d.vy,this.getDistanceFromCenter(d)>this.range&&(d.x=this.x,d.y=this.y,this.vx=10*Math.random()-5,this.vy=10*Math.random()-5)}},Ether.Ether.prototype.stabilityCheck=function(a,b){var c=this.getStability();c>40&&this.age<3&&(a.hub.unstable=!0,c>=50&&b>this.stabilityLastTime+2e3-c&&(this.stabilityLastTime=b,this.loseElements(3)))},Ether.Ether.prototype.zoomOut=function(a){this.range/=a;for(var b=0;b<this.elements.length;b++){var c=this.elements[b];c.radius/=a,c.xOffset/=a,c.yOffset/=a}for(var b=0;b<this.coreElements.length;b++)this.coreElements[b].radius/=a},Ether.Ether.prototype.getDistanceFromCenter=function(a){return this.util.getDistanceFromCenter(this,a)},Ether.Ether.prototype.findDegree=function(a,b){var c=a/b,d=Math.acos(c);return this.util.radToDeg(d)},Ether.Ether.prototype.ageEther=function(a){a>this.ageLastTime+this.healthRate(a)&&(this.ageLastTime=a,0!=this.elements.length&&this.loseElement(this.elements[this.elements.length-1],!0))},Ether.Ether.prototype.healthRate=function(a){this.totalLifeSpan||(this.totalLifeSpan=a+7e4);var b=a-this.totalLifeSpan,c=this.health+10*this.mass-b-this.getStability(),d=c>50?c:50;return d},Ether.Ether.prototype.getStability=function(){var a=this.getElementCount(),b=a.f-a.w,c=a.a-a.e;return Math.floor(Math.sqrt(b*b+c*c))},Ether.Ether.prototype.getElementCount=function(){for(var b=w=a=e=0,c=0;c<this.elements.length;c++){var d=this.elements[c];switch(d.type){case"fire":b+=Math.round(d.radius/5);break;case"water":w+=Math.round(d.radius/5);break;case"air":a+=Math.round(d.radius/5);break;case"earth":e+=Math.round(d.radius/5)}}var f={};return f.f=b,f.w=w,f.a=a,f.e=e,f},Ether.Ether.prototype.newElement=function(a){this.engine.audio.playSound(a),3!=this.age&&this.increaseMass(a),a.xOffset=a.x-this.x,a.yOffset=a.y-this.y,a.range=this.range,a.degree=this.findDegree(a.yOffset,this.getDistanceFromCenter(a)),a.newElement=this.mass/2,this.elements.push(a)},Ether.Ether.prototype.loseElement=function(a){this.decreaseMass(a);for(var b=0;b<this.elements.length;b++){var c=this.elements[b];if(c.x==a.x&&c.y==a.y){var d=this.elements.splice(b,1)[0];return this.engine.world.newElement(d),!0}}},Ether.Ether.prototype.loseElements=function(a){for(var b=0;a>b;b++)random=Math.floor(Math.random()*this.elements.length),0!=this.elements.length&&this.loseElement(this.elements[random],!0)},Ether.Ether.prototype.createCoreElement=function(){var a=new Ether.Element("core");a.x=this.x,a.y=this.y,this.coreElements.push(a)},Ether.Ether.prototype.increaseMass=function(a){this.createCoreElement(),this.mass+=1,this.range+=Math.round(a.radius/6)},Ether.Ether.prototype.decreaseMass=function(a){this.coreElements.length>1&&this.coreElements.pop(),this.mass>0&&(this.mass-=1),this.range>2&&(this.range-=Math.round(a.radius/6))},Ether.Ether.prototype.receiveAward=function(a){this.currentSpan+a>this.lifeSpan[this.age]?this.currentSpan=this.lifeSpan[this.age]:this.currentSpan+=a},Ether.Ether.prototype.rotateElement=function(a,b){b>this.rotateLastTime+500&&(this.rotateDirection<0?(this.degreeChange+=.001,this.degreeChange>1&&(this.degreeChange=1),this.currentSpan<this.lifeSpan[this.age]/3*2&&this.rotateDirection++):this.rotateDirection>0?(this.degreeChange-=.001,this.degreeChange<.001&&(this.degreeChange=.001)):this.currentSpan<this.lifeSpan[this.age]/3&&this.rotateDirection++),360==a.degree?a.degree=0:a.degree+=this.degreeChange,a.xOffset=a.range*Math.cos(this.util.degToRad(a.degree)),a.yOffset=a.xOffset*Math.tan(this.util.degToRad(a.degree))},Ether.Ether.prototype.createSludge=function(a,b){if(b>this.sludgeLastTime+this.sludgeTimeOffset){this.sludgeLastTime=b;for(var c=new Sludge(this.engine,this),d=0;d<this.elements.length;d++){var a=this.elements[d];this.xv>0&&a.x>this.x?this.pushSludge(c,a):this.xv<0&&a.x<this.x?this.pushSludge(c,a):this.yv>0&&a.y>this.y?this.pushSludge(c,a):this.yv<0&&a.y<this.y&&this.pushSludge(c,a)}this.engine.ethers.push(c)}},Ether.Ether.prototype.pushSludge=function(a,b){var c=new Ether.Element(0,0,b);a.elements.push(c)},Ether.Ether.prototype.save=function(a){var b={};b.elements=this.elements.name,b.name=""+a,b.coreElements=this.coreElements;var c=new XMLHttpRequest;c.open("POST","saveEther.php",!0),c.setRequestHeader("Content-Type","application/json; charset=UTF-8"),c.send(JSON.stringify(b)),c.onloadend=function(){console.log("Saved")}},Ether.World=function(a){this.engine=a,this.util,this.player,this.width=30*a.width,this.height=30*a.height,this.x=a.width/2,this.y=a.height/2,this.xv=0,this.yv=0,this.dragLastTime=0,this.speedUp={},this.speedUp.x=!1,this.speedUp.y=!1,this.fire=[],this.water=[],this.earth=[],this.air=[],this.elements=[this.earth,this.air,this.fire,this.water],this.driftArray=[],this.sizeOffset=5e3,this.hills=[],this.hillWidthAmount=4,this.hillHeightAmount=2,this.hillWidth=a.width/this.hillWidthAmount,this.hillHeight=a.height/this.hillHeightAmount},Ether.World.prototype.init=function(a){var b=["earth","air","fire","water"];0!=a.ethers[0].age?this.zoomOut(2):(this.player=a.ethers[0],this.util=a.util),this.initBackground();for(var c=0;c<this.elements.length;c++){var d=this.elements[c];d.length=0;var e=b[c];switch(a.ethers[0].age){case 0:this.initElements(e,d,[5,300],[0,250],[300,50],[9e3,100]),this.initBadGuys(e,d,120,!0);break;case 1:this.initElements(e,d,[70,180],[10,150],[250,50],[7e3,2e3]),this.initBadGuys(e,d,90);break;case 2:this.initElements(e,d,[],[20,80],[200,200],[5e3,1e3]),this.initBadGuys(e,d,60);break;case 3:this.initElements(e,d,[0],[50],[300],[6e3]),this.initBadGuys(e,d,30)}}},Ether.World.prototype.initElements=function(a,b,c,d,e,f){for(var g=0;g<e.length;g++)this.initElement(a,b,e[g],f[g],function(a){d[g]&&a.radius>d[g]&&(a.radius=d[g]),c[g]&&a.radius<c[g]&&(a.radius=c[g])})},Ether.World.prototype.initBadGuys=function(a,b,c,d){var e=d||this.engine.badGuys;e&&this.initElement(a,b,15,100,function(a){a.radius>c&&(a.radius=c)},!0)},Ether.World.prototype.initElement=function(a,b,c,d,e,f){for(var g=0;c>g;g++){var h=(2*Math.random()*this.width-this.width)/2,i=(2*Math.random()*this.height-this.height)/2,j=this.getDistanceFromCenter({x:h,y:i}),k=new Ether.Element(a,j/d,{},f);e(k),k.xOffset=h,k.yOffset=i,b.push(k)}},Ether.World.prototype.initBackground=function(){for(var a=0;a<this.hillHeightAmount+2;a++){for(var b=[],c=0;c<this.hillWidthAmount+2;c++)b[c]={x:this.hillWidth*c,y:this.hillHeight*a};this.hills.push(b)}},Ether.World.prototype.draw=function(a,b){this.xv=this.adjustVelocity("x",this.xv,b),this.yv=this.adjustVelocity("y",this.yv,b),b>this.dragLastTime+200&&(this.dragLastTime=b),this.drawBackground(this.xv,this.yv),this.x+=this.xv,this.y+=this.yv,this.player.xv=this.xv,this.player.yv=this.yv,a.xv=this.xv,a.yv=this.yv;for(var c=0;c<this.elements.length;c++)for(var d=this.elements[c],e=0;e<d.length;e++){var f=d[e];if(this.isInView(f)){f.jitter*=-1,f.x=this.x+f.xOffset+f.jitter,f.y=this.y+f.yOffset,this.driftTowardsEther(f),a.ctx.beginPath();var g=a.ctx.createRadialGradient(f.x,f.y,0,f.x,f.y,f.radius);f.bad?this.util.createGradient(g,[[.1,"rgba("+Math.round(255*Math.random())+","+Math.round(255*Math.random())+","+Math.round(255*Math.random())+",1)"],[.3,"black"],[.7,"black"],[.9,"rgba("+Math.round(255*Math.random())+","+Math.round(255*Math.random())+","+Math.round(255*Math.random())+",1)"]]):this.util.createGradient(g,[[.1,"white"],[.1,"white"],[.8,f.color],[.1,"black"]]),a.ctx.fillStyle=g,a.ctx.arc(f.x,f.y,f.radius,2*Math.PI,!1),a.ctx.fill(),this.isInRangeOfEther(f,c,e)}}this.drawDriftingElements(a),this.drawBorder(a)},Ether.World.prototype.zoomOut=function(a){this.hillHeightAmount*=a,this.hillWidthAmount*=a,this.hillWidth=this.engine.width/this.hillWidthAmount,this.hillHeight=this.engine.height/this.hillHeightAmount},Ether.World.prototype.drawBackground=function(a,b){for(var c=0;c<this.hills.length;c++)for(var d=this.hills[c],e=0;e<d.length;e++){var f=d[e];f.x+=a,f.y+=b,f.x+this.hillWidth<0&&(f.x=this.engine.width),f.x>this.engine.width&&(f.x=-this.hillWidth),f.y+this.hillHeight<0&&(f.y=this.engine.height),f.y>this.engine.height&&(f.y=-this.hillHeight);var g=this.engine.ctx.createLinearGradient(f.x,f.y,f.x+this.hillWidth,f.y+this.hillHeight);this.engine.ctx.fillStyle=this.util.createGradient(g,[[.05,"rgba(0,0,0,1)"],[.95,"rgba(20,20,20,1)"]]),this.engine.ctx.fillRect(f.x,f.y,this.hillWidth+5,this.hillHeight+5)}},Ether.World.prototype.driftTowardsEther=function(a){var b,c=this.player,d=a.radius<40?20*a.radius:2*a.radius;if(b=a.bad?c.speed-2:a.radius>50?a.radius/50:a.radius/5,a.bad||this.util.getDistanceFromCenter(a,c)<=d)for(var e;!e;){var f=Math.floor(4*Math.random());switch(f){case 0:a.x<c.x+5&&(a.xOffset+=b,e=!0);break;case 1:a.x>c.x-5&&(a.xOffset-=b,e=!0);break;case 2:a.y<c.y+5&&(a.yOffset+=b,e=!0);break;case 3:a.y>c.y-5&&(a.yOffset-=b,e=!0)}}},Ether.World.prototype.removeBadElements=function(){for(var a=0;a<this.elements.length;a++)for(var b=this.elements[a],c=0;c<b.length;c+=1){var d=b[c];d.bad&&(b.splice(c,1),c-=1)}},Ether.World.prototype.drawBorder=function(a){a.ctx.fillStyle="white",this.borderX=this.x-this.width/2,this.borderY=this.y-this.height/2,this.borderW=this.width,this.borderH=this.height,a.ctx.strokeRect(this.borderX,this.borderY,this.borderW,this.borderH)},Ether.World.prototype.drawDriftingElements=function(a){for(var b=0;b<this.driftArray.length;b++){var c=this.driftArray[b];c.xOffset+=c.jitter*c.radius/2;var d=this.x+c.xOffset,e=this.y+c.yOffset;a.ctx.beginPath();var f=a.ctx.createRadialGradient(d,e,0,d,e,c.radius);if(a.ctx.fillStyle=this.util.createGradient(f,[[.1,"white"],[.1,"white"],[.8,c.color],[.1,"black"]]),a.ctx.arc(d,e,c.radius,2*Math.PI,!1),a.ctx.fill(),c.newElement)c.newElement--;else{var g="earth"==c.type?0:"air"==c.type?1:"fire"==c.type?2:"water"==c.type?3:void 0;c.jitter/=5,this.driftArray.splice(b,1),b--,this.elements[g].push(c)}}},Ether.World.prototype.isInRangeOfEther=function(a,b,c){if(this.isInView(a)){var d=this.player,e=d.range+a.radius/2,f=a.xOffset+this.x,g=a.yOffset+this.y,h=d.getDistanceFromCenter({x:f,y:g});e>h&&(a.bad?(this.engine.audio.playSound(a),d.loseElements(1),d.elements.length>6&&d.tripleLoss()):(a.x=f,a.y=g,d.newElement(a),this.elements[b].splice(c,1)))}},Ether.World.prototype.isInView=function(a){var b=a.xOffset+this.x,c=a.yOffset+this.y;return b>-a.radius&&b<this.engine.width+a.radius&&c>-a.radius&&c<this.engine.height+a.radius?!0:void 0},Ether.World.prototype.getDistanceFromCenter=function(a){return this.engine.util.getDistanceFromCenter(a,this)},Ether.World.prototype.adjustVelocity=function(a,b,c){return c>this.dragLastTime+200&&(this.speedUp[a]?b>0&&b<=this.player.speed?(b+=2,b>this.player.speed&&(b=this.player.speed)):0>b&&b>=-this.player.speed&&(b-=2,b<-this.player.speed&&(b=-this.player.speed)):0!=b&&(b>0?(b-=2,0>b&&(b=0)):0>b&&(b+=2,b>0&&(b=0)))),b},Ether.World.prototype.handleKeyDown=function(a){switch(a){case 87:case 38:!this.speedUp.y&&this.yv>=-5?(this.speedUp.y=!0,this.yv=1):this.yv<-5&&(this.speedUp.y=!1),this.player.moved=!0;break;case 68:case 39:!this.speedUp.x&&this.xv<=5?(this.speedUp.x=!0,this.xv=-1):this.xv>5&&(this.speedUp.x=!1),this.player.moved=!0;break;case 83:case 40:!this.speedUp.y&&this.yv<=5?(this.speedUp.y=!0,this.yv=-1):this.yv>5&&(this.speedUp.y=!1),this.player.moved=!0;break;case 65:case 37:!this.speedUp.x&&this.xv>=-5?(this.speedUp.x=!0,this.xv=1):this.xv<-5&&(this.speedUp.x=!1),this.player.moved=!0}},Ether.World.prototype.handleKeyUp=function(a){switch(a){case 38:this.speedUp.y=!1;break;case 39:this.speedUp.x=!1;break;case 40:this.speedUp.y=!1;break;case 37:this.speedUp.x=!1}},Ether.World.prototype.handleTouch=function(a){console.log(a.changedTouches)},Ether.World.prototype.handleTouchEnd=function(a){console.log(a.changedTouches)},Ether.World.prototype.newElement=function(a){var b=this.player;a.xOffset=a.x-this.x,a.yOffset=a.y-this.y,a.newElement=10,a.jitter*=4,(a.x<b.x&&a.jitter>0||a.x>b.x&&a.jitter<0)&&(a.jitter*=-1),this.driftArray.push(a)},Ether.Hub=function(a){var b=this;this.engine=a,this.unit=a.width/50,this.showInfo=!0,this.lastTime=0,this.messageExist=!1,this.messageAlpha=1,this.currentMessage="",this.lastMessageTime=0,this.betweenAlpha=.1,this.betweenLastTime=0,this.intro=!0,this.lastIntroTime=0,this.introAlpha=0,this.introText=["","an ether is born","you are born","collect the four elements","grow into yourself","and die","as all things that are born must","seek balance"],this.introIndex=0,this.timeOffset=0,this.choice1Alpha=.2,this.choice2Alpha=.2,this.question=0,this.awardMssg="",this.lifeStageMssg="",this.lifeStageOpts=["spread your wings","spread your trail"],this.gameOverLastTime=0,this.gameOverAlpha=0,this.gameOverWidth,this.gameOverColor="rgba(255,255,255,",this.mousemove=function(a){{var c=a.x;a.y}return b.gameOverWidth?void(b.gameOverColor="rgba(255,0,0,"!=b.gameOverColor&&a.x>b.engine.width-2*b.gameOverWidth&&a.y>b.engine.height-2*b.gameOverWidth?"rgba(255,0,0,":"rgba(255,255,255,"):void(c<=b.engine.width/2?(b.choice1Alpha=.5,b.choice2Alpha=.2):(b.choice1Alpha=.2,b.choice2Alpha=.5))},this.handleClick=function(a){if(b.gameOverWidth)return void(a.x>b.engine.width-2*b.gameOverWidth&&a.y>b.engine.height-2*b.gameOverWidth&&(window.location.href="index.html"));switch(b.question){case 0:b.showInfo=b.choice1Alpha>b.choice2Alpha?!0:!1;break;case 1:b.engine.setAwards(b.choice1Alpha>b.choice2Alpha?"matter":"consciousness");break;case 2:var c=b.engine.ethers[0];c.transformation=b.choice1Alpha>b.choice2Alpha?c.transformations[0]:c.transformations[1],b.lifeStageMssg=b.choice1Alpha>b.choice2Alpha?b.lifeStageOpts[0]:b.lifeStageOpts[1];break;case 3:b.engine.badGuys=b.choice1Alpha>b.choice2Alpha?!0:!1,b.engine.badGuys||b.engine.world.removeBadElements()}b.question>3&&b.introIndex+1<b.introText.length?(b.timeOffset=b.lastIntroTime,b.introIndex++,b.introIndex!=b.introText.length-1&&(b.introAlpha=0)):b.introIndex+1!=b.introText.length&&(b.question++,b.introAlpha=0)},this.handleKeyDown=function(){b.question>3&&b.introIndex+1<b.introText.length&&(b.timeOffset=b.lastIntroTime,b.introIndex++,b.introIndex!=b.introText.length-1&&(b.introAlpha=0))}},Ether.Hub.prototype.init=function(){window.onmousemove=this.mousemove,window.onclick=this.handleClick},Ether.Hub.prototype.drawIntro=function(a){var b=this.engine.ctx;this.question<=3?(this.drawAnswerBoxes(b,a),this.drawQuestionText(b,a)):this.drawIntroText(b,a)},Ether.Hub.prototype.drawIntroText=function(a,b){b>this.lastIntroTime+50&&(this.introAlpha+=.1,this.lastIntroTime=b,this.introAlpha>1&&(this.introAlpha=1),this.lastIntroTime-this.timeOffset>3e3&&(this.timeOffset=this.lastIntroTime,this.introAlpha=0,this.introIndex++,this.introIndex==this.introText.length&&(this.intro=!1)));var c=this.introText[this.introIndex],d=a.measureText(c).width;a.fillStyle="rgba(255,255,255,"+this.introAlpha+")",a.fillText(c,this.engine.width/2-d/2,this.engine.height/2)},Ether.Hub.prototype.drawQuestionText=function(a,b){var c=["Which is more true?","To which are you destined?","Which is your body?","Which do you desire?"],d=[["Knowledge is Power.","Reality is Unknown."],["Matter","Consciousness"],["A Butterfly","A Snail"],["Struggle","Peace"]],e=c[this.question],f=d[this.question],g=a.measureText(e).width;b>this.lastIntroTime+50&&(this.lastIntroTime=b,this.introAlpha+=.05,this.introAlpha>1&&(this.introAlpha=1)),a.font="28pt Titillium Web",a.fillStyle="rgba(164,161,151,"+this.introAlpha+")",a.fillText(e,this.engine.width/2-g/2,2*this.unit);var h=a.measureText(f[0]).width,i=a.measureText(f[1]).width;a.fillText(f[0],this.engine.width/4-h/2,this.engine.height/2),a.fillText(f[1],this.engine.width/4*3-i/2,this.engine.height/2)},Ether.Hub.prototype.drawAnswerBoxes=function(a){var b=this.engine.width,c=this.engine.height;a.fillStyle="rgba(75,100,75,"+this.choice1Alpha+")",a.fillRect(0,0,b/2,c),a.fillStyle="rgba(75,75,100,"+this.choice2Alpha+")",a.fillRect(b/2,0,b/2,c)},Ether.Hub.prototype.draw=function(a){var b=this.getStats(),c=this.engine.ctx,d=b.stab>100?0:100-b.stab;this.showInfo&&(c.font=this.unit+"30px Titillium Web",c.fillStyle="rgba(164,161,151,1)",c.fillText("Mass: "+Math.floor(b.mass),this.unit,1.5*this.unit),c.fillText("Balance: "+d,this.unit,2.5*this.unit)),this.drawInbetween(c,a),this.showInfo&&this.drawElementStats(b.elementCount,c),this.drawLifeBar(c,a),this.drawMessage(c,a)},Ether.Hub.prototype.drawInbetween=function(a,b){var c=this.engine.ethers[0].age;this.engine.betweenAges&&(3>c?b>this.betweenLastTime+100&&(this.betweenLastTime=b,a.fillStyle="rgba(164,161,151,"+this.betweenAlpha+")",a.fillRect(0,0,this.engine.width,this.engine.height)):this.gameOver(a,b))},Ether.Hub.prototype.newAward=function(a){this.awardMssg=a,this.drawMessage(0,0,!0)},Ether.Hub.prototype.getStats=function(){var a={},b=this.engine.ethers[0];return a.mass=b.mass,a.stab=b.getStability(),a.elementCount=b.getElementCount(),a.range=b.range,a},Ether.Hub.prototype.drawElementStats=function(a,b){b.font=.75*this.unit+"px Titillium Web",b.fillStyle="red",b.fillText("Fire: "+a.f,this.unit,3.2*this.unit),b.fillStyle="#3399FF",b.fillText("Water: "+a.w,3.5*this.unit,3.2*this.unit),b.fillStyle="white",b.fillText("Air: "+a.a,this.unit,4.1*this.unit),b.fillStyle="green",b.fillText("Earth: "+a.e,3.5*this.unit,4.1*this.unit)},Ether.Hub.prototype.drawLifeBar=function(a,b){if(!this.engine.betweenAges){var c=["green","yellow","orange","red"],d=this.engine.ethers[0],e=3!=d.age?d.currentSpan/d.lifeSpan[d.age]:d.elements.length/d.finalElementLength;a.fillStyle="#FFF4E9",a.font=this.unit+"px Titillium Web",a.fillText("Lifespan "+(this.engine.ethers[0].age+1),this.engine.width-5.5*this.unit,this.unit),a.fillStyle=c[d.age],a.fillRect(this.engine.width-.5*this.unit,1.5*this.unit,-(5*this.unit)*e,.5*this.unit),a.strokeStyle="red",a.strokeRect(this.engine.width-5.5*this.unit,1.5*this.unit,5*this.unit,.5*this.unit),d.moved&&b>this.lastTime+1e3&&!d.inVoid&&(this.lastTime=b,e>0?d.currentSpan--:(this.engine.betweenAges=!0,this.messageExist=!1))}},Ether.Hub.prototype.drawMessage=function(a,b,c){var d=this.engine.ethers[0],e="there is no time in the boundless void",f="you are no longer an infant",g="give back you borrowed",h="so it goes",i="Save The Big Ones For Post-Infancy",j="You Are Becoming Too Unstable";if(c&&!this.engine.betweenAges&&(this.messageExist=!1,this.messageAlpha=1),this.messageExist)c||this.renderMessage(a,b);else if(this.engine.betweenAges)switch(this.messageExist=!0,d.age){case 0:this.currentMessage=f;break;case 1:this.currentMessage=this.lifeStageMssg;break;case 2:this.currentMessage=g;break;case 3:this.currentMessage=h}else this.awardMssg?(this.messageExist=!0,this.currentMessage=this.awardMssg):this.hasLeftBorder()&&this.currentMessage!=e?(this.messageExist=!0,this.currentMessage=e):this.killerElement?(this.messageExist=!0,this.currentMessage=i):this.unstable&&!this.stableWarned&&(this.messageExist=!0,this.stableWarned=!0,this.currentMessage=j)},Ether.Hub.prototype.renderMessage=function(a,b){a.font=this.currentMessage==this.awardMssg?"90px Titillium Web":"30px Titillium Web";var c=a.measureText(this.currentMessage).width;c>this.engine.width-10&&(a.font="70px Titillium Web",c=a.measureText(this.currentMessage).width);var d=this.engine.width/2-c/2,e=this.engine.height/2-this.unit;a.fillStyle="rgba(0,0,0,"+this.messageAlpha+")",a.fillText(this.currentMessage,d+2,e+2),a.fillStyle="rgba(164,161,151,"+this.messageAlpha+")",a.fillText(this.currentMessage,d,e),b>this.lastMessageTime+100&&(this.messageAlpha-=.01,this.messageAlpha<=.01&&(this.messageExist=!1,this.messageAlpha=1,this.awardMssg="",this.killerElement=!1,this.engine.betweenAges&&!this.engine.ethers[0].dead&&(this.currentMessage="",this.engine.betweenAges=!1,this.engine.ethers[0].age++,this.engine.ethers[0].save(this.engine.ethers[0].age),this.engine.ethers[0].currentSpan=this.engine.ethers[0].lifeSpan[this.engine.ethers[0].age],this.engine.ethers[0].age<4&&this.engine.init())),this.lastMessageTime=b)},Ether.Hub.prototype.hasLeftBorder=function(){var a=this.engine.ethers[0],b=this.engine.world;return a.x<=b.borderX||a.y<=b.borderY||a.x>=b.vorderX+b.borderW||a.y>=b.borderY+b.borderH?(a.inVoid=!0,!0):void(a.inVoid=!1)},Ether.Hub.prototype.gameOver=function(a,b){b>this.gameOverLastTime+100&&1!=this.gameOverAlpha&&(this.gameOverAlpha+=.02,this.gameOverAlpha>1&&(this.gameOverAlpha=1)),a.fillStyle=this.gameOverColor+this.gameOverAlpha+")",a.font="1em Courier";var c="Restart";this.gameOverWidth=a.measureText(c).width,a.fillText(c,this.engine.width-1.5*this.gameOverWidth,this.engine.height-10)},Ether.Audio=function(){this.engine,this.ctx,this.audio={}},Ether.Audio.prototype.init=function(){this.loadSounds()},Ether.Audio.prototype.loadSounds=function(a){var b=["fire","water","air","earth"],a=a||0,c=this,d=b[a];this.audio[d]=new Audio("audio/"+d+".wav"),a!=b.length-1?(a++,c.loadSounds(a)):c.loaded=!0},Ether.Audio.prototype.playSound=function(a){var b=a.bad?1:a.radius/125;b>1&&(b=1),this.audio[a.type].volume=b,this.audio[a.type].play()},Ether.Engine=function(){var a=this;this.canvas=document.getElementById("canvas"),this.ctx=this.canvas.getContext("2d"),this.width=window.innerWidth,this.height=window.innerHeight,this.xv,this.yv,this.world=new Ether.World(this),this.hub=new Ether.Hub(this),this.util=new Ether.Util(this),this.audio=new Ether.Audio(this),this.ethers=[new Ether.Ether(a)],this.player=this.ethers[0],this.betweenAges=!1,this.gameOverAlpha=0,this.gameOverTime=0,this.awardDelay=-5e3,this.animate=function(b){if(requestAnimFrame(a.animate),a.player.dead||(a.ctx.fillStyle="black",a.ctx.fillRect(0,0,a.width,a.height)),a.hub.intro)a.hub.drawIntro(b);else if(a.betweenAges)a.hub.draw(b);else if(a.player.dead)a.player.dead&&b>a.gameOverTime+100&&(a.gameOverAlpha+=.01,a.gameOverTime=b,a.ctx.fillStyle="rgba(255,255,255,+"+a.gameOverAlpha+");",a.ctx.fillRect(0,0,a.width,a.height),a.ctx.font="30px Arial",a.ctx.fillStyle="black",a.ctx.fillText("Dead",a.width/2,a.height/2));else{a.world.draw(a,b),a.player.dying||a.checkAwards(b);for(var c=0;c<a.ethers.length;c++)a.ethers[c].draw(a,b);a.ctx.globalCompositeOperation="source-over",a.hub.draw(b)}}},Ether.Engine.prototype.init=function(){var a=this;this.canvas.width=this.width,this.canvas.height=this.height,this.ctx.fillStyle="rgba(0,0,0,0.3)",this.ctx.fillRect(0,0,this.width,this.height),this.player.init(),window.mobilecheck()?(this.canvas.addEventListener("touchstart",function(b){b.preventDefault(),a.world.handleTouch(b,a),a.hub.handleKeyDown()}),this.canvas.addEventListener("touchmove",function(b){b.preventDefault(),a.world.handleTouch(b,a),a.hub.handleKeyDown()})):(window.onkeydown=function(b){a.world.handleKeyDown(b.keyCode,a),a.hub.handleKeyDown()
},window.onkeyup=function(b){a.world.handleKeyUp(b.keyCode,a)}),this.hub.init(),this.world.init(this),this.audio.init(),0==this.player.age&&window.requestAnimFrame(this.animate)},Ether.Engine.prototype.checkAwards=function(a){var b=this.player.getElementCount();if(a>this.awardDelay+5e3){this.awardLastTime=a;for(var c=0;c<this.awards.length;c++){var d=this.awards[c];if(!d.awarded){for(var e=["f","w","e","a"],f=0;f<e.length&&b[e[f]]>=d.amount;f++)f==e.length-1&&(d.awarded=!0,this.hub.newAward(d.text),this.player.receiveAward(d.award),this.awardDelay=a);break}}}},Ether.Engine.prototype.setAwards=function(a){this.awards=Ether.awards[a];for(var b=1,c=1,d=0;d<this.awards.length;d++)this.awards[d].amount=b,this.awards[d].award=Math.ceil(c/5),b+=3,c=d+1},Ether.Engine.prototype.removeEther=function(a){for(var b=this.ethers.length;b>0;b--)if(this.ethers[b]&&this.ethers[b].x==a.x&&this.ethers[b].y==a.y)return void this.ethers.splice(b,1)};var e=new Ether.Engine;e.init();