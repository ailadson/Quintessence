function Sludge(a,b){var c=this;this.engine=a,this.world=a.world,this.player=b,this.elements=[],this.alpha=.5,this.alphaTime=0,this.nTime=0,this.x=b.x,this.y=b.y,this.xOffset=this.x-this.world.x,this.yOffset=this.y-this.world.y,this.draw=function(a,b){if(c.x=this.world.x+this.xOffset,c.y=this.world.y+this.yOffset,b>c.alphaTime+200){if(c.alphaTime=b,0==c.alpha)return void c.destroy();c.alpha-=this.player.sludgeAlphaStep,c.alpha<0&&(c.alpha=0)}for(var d=0;d<c.elements.length;d++){var e=c.elements[d];b>c.nTime+50&&(d==c.elements.length-1&&(c.nTime=b),e.radius+=1),e.x=c.x+e.xOffset,e.y=c.y+e.yOffset,e.x>-(e.radius+3)&&e.x<a.width+e.radius+3&&e.y>-(e.radius+3)&&e.y<a.height+e.radius+3&&(a.ctx.beginPath(),c.engine.util.drawElement(e,a.ctx,function(a,b){var d="rgba("+b.rgb.r+","+b.rgb.g+","+b.rgb.b+","+c.alpha+")";return d}))}},this.destroy=function(){c.engine.removeEther(c)}}window.mobilecheck=function(){var a=!1;return function(b){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(b)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(b.substr(0,4)))&&(a=!0)}(navigator.userAgent||navigator.vendor||window.opera),a},Ether.Element=function(a,b,c,d){var c=c||{};this.type=c.type||a,this.bad=d,c.rgb=c.rgb||{};var e=c.rgb.r||255*Math.random()>>0,f=c.rgb.g||255*Math.random()>>0,g=c.rgb.b||255*Math.random()>>0;switch(a){case"core":150>=e&&(e+=100),150>=f&&(f+=100),150>=g&&(g+=100);break;case"fire":e=255,f>=125&&(f=75),g>=100&&(g=50);break;case"water":g=255,e>=75&&(e=50),f>=175&&(f-=100);break;case"air":185>=e&&(e=230),185>=f&&(f=230),g=255;break;case"earth":g=0,(e>200||100>e)&&(e=150),(f>175||120>f)&&(f=150)}this.color="rgba("+e+","+f+","+g+",0.5)",this.rgb={r:e,g:f,b:g,a:.5};var h=b||.5;if(this.radius=c.radius,!this.radius)switch(a){case"core":this.radius=15*Math.random()+5*h;default:this.radius=15*Math.random()+5*h}this.vx=10*Math.random()-5,this.vy=10*Math.random()-5,this.x,this.y,this.xOffset=c.xOffset,this.yOffset=c.yOffset,this.jitter=d?-5:-1},Ether.MsgQue=function(){this.que=[]},Ether.MsgQue.prototype.addMsg=function(a){this.que.push(new Ether.Msg(a))},Ether.MsgQue.prototype.getMsg=function(){return this.que.shift()},Ether.MsgQue.prototype.hasMsg=function(){return this.que.length>0},Ether.Msg=function(a){this.str=a.string,this.sub=a.sub||"",this.alpha=1,this.alphaStep=a.alphaStep||.02,this.alphaTime=a.alphaTime||100,this.type=a.type,this.fill=a.fill||"rgba(164,161,151,"},Ether.Msg.prototype.lowerAlpha=function(){return this.alpha-=this.alphaStep,this.alpha<0&&(this.alpha=0),this.alpha},Ether.Msg.prototype.isFadedEnuf=function(){return this.alpha<.3},Ether.awards={},Ether.awards.matter=[{text:"String(1 x 10^-35)"},{text:"Quantum Foam(1 x 10^-35)"},{text:"Neutrino(1 x 10^-24)"},{text:"Quark(1 x 10^-19)"},{text:"Proton(1 x 10^-15)"},{text:"Neutron(1 x 10^-15)"},{text:"Electrons(1 x 10^-15)"},{text:"Rays(1 x 10^-12)"},{text:"Atoms(1 x 10^-10)"},{text:"Proteins(1 x 10^-10)"},{text:"Molecules(1 x 10^-9)"},{text:"Clay Particles(1 x 10^-6)"},{text:"Mist Droplets(1 x 10^-5)"},{text:"Viruses(1 x 10^-8)"},{text:"Large Rocks(5 x 10^3)"},{text:"Moons(1.5 x 10^5)"},{text:"Bacteria(1 x 10^-3)"},{text:"Planets(1.27 x 10^7)"},{text:"Nebula(8^10 x 16)"},{text:"Protozoa(1 x 10^-5)"},{text:"Choanoflagellate(7 x 10^-6)"},{text:"Stars(5.8 x 10^9)"},{text:"Galaxies(1.2 x 10^21)"},{text:"Clusters(3 x 10^23)"},{text:"Chromistas(1 x 10^-1)"},{text:"Fungi(7 x 10^3)"},{text:"Invertebrates(4 x 10-2)"},{text:"Plants(1.5 x 10^1)"},{text:"Vertebrates(1 x 10^-1)"},{text:"Land Animals(3 x 10^0)"},{text:"Intelligence(1.7 x 10^0)"},{text:"Symbolic Systems(1.7 x 10^0)"},{text:"Mechanical Systems(1.5 x 10^1)"},{text:"Digital Systems(3.2 x 10^-8)"},{text:"Bioengineered Systems(1.7 x 10^0)"},{text:"Quantum Systems(1 x 10^-10)"},{text:"Artifical Intelligence(3.2 x 10^-8)"},{text:"Planetary Societies(1.27 x 10^7)"},{text:"Synchronized Mind(1.7 x x10^0)"},{text:"Solar Societies(1.2 x 10^10)"},{text:"Giant Stars(8 x 10^11)"},{text:"Dwarf Stars(1.27 x 10^7)"},{text:"String Computing(1 x 10^-35)"},{text:"Neutron Stars(1.3 x 10^4)"},{text:"Supernovas(9.5 x 10^16)"},{text:"Galactic Societies(1.2 x 10^21)"},{text:"Multi-Demensional Computing(~)"},{text:"Black Holes"},{text:"Thermal Equilibrium"},{text:"[silence]"}],Ether.awards.consciousness=[{text:"I"},{text:"I am"},{text:"Me"},{text:"Mine"},{text:"You"},{text:"I love"},{text:"I am sleepy"},{text:"I am hot"},{text:"I am cold"},{text:"I am thirsty"},{text:"I am hungry"},{text:"I am horny"},{text:"I am in the world"},{text:"I want this"},{text:"Why can't I have that?"},{text:"I'm afraid"},{text:"Why do I hurt?"},{text:"How do I get more?"},{text:"Who are my friends?"},{text:"How can I thrive?"},{text:"This is my stuff"},{text:"I am right"},{text:"They are wrong"},{text:"I will create"},{text:"Will I die?"},{text:"Everything dies"},{text:"Why am I here?"},{text:"I will die"},{text:"Who am I?"},{text:"Where did I come from?"},{text:"This is the truth"},{text:"That is not the truth"},{text:"This is who I am"},{text:"Who I am keeps changing"},{text:"I am my thougts"},{text:"My thoughts always change"},{text:"Do I change?"},{text:"What is constant?"},{text:"I am awareness"},{text:"Was awareness always here?"},{text:"From here did this awareness come?"},{text:"All comes from nothing"},{text:"All goes to nothing"},{text:"I am all"},{text:"I am nothing"},{text:"I am self evident"},{text:"I am self here"},{text:"No word is true"},{text:"How can sounds describe silence?"},{text:"[silence]"}],Ether.Util=function(a){this.engine=a},Ether.Util.prototype.degToRad=function(a){return Ether.Util.radianInDeg*a},Ether.Util.prototype.radToDeg=function(a){return Ether.Util.degreeInRad*a},Ether.Util.radianInDeg=180/Math.PI,Ether.Util.degreeInRad=Math.PI/180,Ether.Util.prototype.getDistanceFromCenter=function(a,b){var c=b.x-Math.abs(a.x),d=b.y-Math.abs(a.y);return Math.sqrt(c*c+d*d)},Ether.Util.prototype.createGradient=function(a,b){for(var c=0;c<b.length;c++){var d=b[c];a.addColorStop(d[0],d[1])}return a},Ether.Util.prototype.drawElement=function(a,b,c){var d=c(b,a);b.fillStyle=d,b.arc(a.x,a.y,a.radius,2*Math.PI,!1),b.fill()},Ether.Util.prototype.getLocalStorage=function(){try{if(window.localStorage)return window.localStorage}catch(a){return!1}},Ether.Ether=function(a){this.engine=a,this.util=a.util,this.rotateLastTime=0,this.coreElements=[],this.elements=[],this.moved,this.receivedFirstElement=!1,this.enemySeen=!1,this.x=a.width/2,this.y=a.height/2,this.xv,this.yv,this.range=15,this.mass=1,this.speed=18,this.control=10,this.getControl=function(){return.01*this.speed*this.control},this.resistance=4,this.attraction=0,this.balance=1,this.force=100,this.elementCount={f:0,w:0,a:0,e:0},this.health=5e3,this.lifeSpan=[400],this.currentSpan=this.lifeSpan[0],this.totalLifeSpan,this.ageLastTime=0,this.finalElementLength=1,this.stabilityLastTime=0,this.unstable=!1,this.bigElementIncrease=!1,this.oldSum=9999,this.purging=!1,this.dying=!1,this.dead=!1,this.transformation,this.transformations={butterfly:this.rotateElement,snail:this.createSludge},this.sludgeTimeOffset=500,this.sludgeAlphaStep=.1,this.sludgeLastTime=0,this.rotateLastTime=0,this.rotateDirection=-1,this.degreeChange=0,this.blownUpElements=[],this.blowUpTime=0,this.canZoom=!1,this.zooming=!1,this.zoomLastTime=0,this.zoomDelay=500,this.zoomStep=1.07,this.zoomCounter=4,this.zoomCounterMax=this.zoomCounter,this.zoom=1},Ether.Ether.prototype.init=function(){this.createCoreElement()},Ether.Ether.prototype.draw=function(a,b){this.zooming&&this.getMoreScreen(b),this.drawCoreElements(a),this.drawElements(a,b),this.stabilityCheck(a,b),this.checkZoom()},Ether.Ether.prototype.drawElements=function(a,b){var c=this;this.bigElementIncrease=this.hadBigElementIncrease();for(var d=0;d<this.elements.length;d++){var e=this.elements[d];this.engine.isPaused||(e.x=this.x+e.xOffset+e.jitter*(this.getStability()/10),e.y=this.y+e.yOffset,e.jitter*=-1),this.transformation?this.transformation(e,b):this.dead&&(this.loseElements(2),this.isGameOver()),a.ctx.beginPath(),c.util.drawElement(e,a.ctx,function(b,d){var e=a.ctx.createRadialGradient(d.x,d.y,0,d.x,d.y,d.radius);return.5!=d.rgb.a?c.util.createGradient(e,[[.1,"white"],[.1,"white"],[.8,d.color],[.1,"black"]]):c.util.createGradient(e,[[.1,"rgba(255,255,255,"+d.rgb.a+")"],[.1,"rgba(255,255,255,"+d.rgb.a+")"],[.8,d.color],[.1,"rgba(0,0,0,"+d.rgb.a+")"]])})}this.transformation&&b>this.rotateLastTime+500&&(this.rotateLastTime=b)},Ether.Ether.prototype.drawCoreElements=function(a){var b=this;a.ctx.globalCompositeOperation="lighter";for(var c=0;c<this.coreElements.length;c++){var d=this.coreElements[c];a.ctx.beginPath(),b.util.drawElement(d,a.ctx,function(a,c){var d=a.createRadialGradient(c.x,c.y,0,c.x,c.y,c.radius);return b.util.createGradient(d,[[.5,"white"],[.4,c.color],[1,"black"]])}),this.engine.isPaused||(d.x+=d.vx,d.y+=d.vy,this.getDistanceFromCenter(d)>this.range&&(d.x=this.x,d.y=this.y,this.vx=10*Math.random()-5,this.vy=10*Math.random()-5))}},Ether.Ether.prototype.stabilityCheck=function(a,b){var c=this.getStability();this.unstable=c>=20&&!this.dead?!0:!1,c>=50&&!this.dead?(this.purging=!0,b>this.stabilityLastTime+2e3-c&&(this.stabilityLastTime=b,this.loseElements(3))):a.hub.purging=!1},Ether.Ether.prototype.getDistanceFromCenter=function(a){return this.util.getDistanceFromCenter(this,a)},Ether.Ether.prototype.findDegree=function(a,b){var c=a/b,d=Math.acos(c);return this.util.radToDeg(d)},Ether.Ether.prototype.ageEther=function(a){if(a>this.ageLastTime+this.healthRate(a)&&(this.ageLastTime=a,0!=this.elements.length)){var b=this.loseElement(this.elements[this.elements.length-1],!0);this.engine.audio.playElementSound(b)}},Ether.Ether.prototype.healthRate=function(a){this.totalLifeSpan||(this.totalLifeSpan=a+7e4);var b=a-this.totalLifeSpan,c=this.health+10*this.mass-b-this.getStability(),d=c>50?c:50;return d},Ether.Ether.prototype.getStability=function(){var a=this.getElementCount(),b=a.f-a.w,c=a.a-a.e,d=Math.floor(Math.sqrt(b*b+c*c)),e=Math.round(d/this.balance);return e},Ether.Ether.prototype.getElementCount=function(){return this.elementCount},Ether.Ether.prototype.hadBigElementIncrease=function(){var a=4;for(var b in this.elementCount)a+=this.elementCount[b];return a>=2*this.oldSum?(this.oldSum=a,!0):(this.oldSum=4>=a?9999:a,this.bigElementIncrease)},Ether.Ether.prototype.addToElementCount=function(a){switch(a.type){case"fire":this.elementCount.f+=Math.round(a.radius/2);break;case"water":this.elementCount.w+=Math.round(a.radius/2);break;case"air":this.elementCount.a+=Math.round(a.radius/2);break;case"earth":this.elementCount.e+=Math.round(a.radius/2)}},Ether.Ether.prototype.removeFromElementCount=function(a){switch(a.type){case"fire":this.elementCount.f-=Math.round(a.radius/2),this.elementCount.f<0&&(this.elementCount.f=0);break;case"water":this.elementCount.w-=Math.round(a.radius/2),this.elementCount.w<0&&(this.elementCount.w=0);break;case"air":this.elementCount.a-=Math.round(a.radius/2),this.elementCount.a<0&&(this.elementCount.a=0);break;case"earth":this.elementCount.e-=Math.round(a.radius/2),this.elementCount.e<0&&(this.elementCount.e=0)}},Ether.Ether.prototype.newElement=function(a){this.receivedFirstElement=!0,this.engine.audio.playElementSound(a),this.addToElementCount(a),this.increaseMass(a),a.xOffset=a.x-this.x,a.yOffset=a.y-this.y,a.range=this.range,a.degree=this.findDegree(a.yOffset,this.getDistanceFromCenter(a)),a.newElement=this.mass/2,this.elements.push(a)},Ether.Ether.prototype.loseElement=function(a){this.removeFromElementCount(a),this.decreaseMass(a);for(var b=0;b<this.elements.length;b++){var c=this.elements[b];if(c.x==a.x&&c.y==a.y){var d=this.elements.splice(b,1)[0];return this.engine.world.newElement(d),c}}},Ether.Ether.prototype.loseElements=function(a){for(var b=0;a>b;b++){var c=Math.floor(Math.random()*this.elements.length);0!=this.elements.length&&this.loseElement(this.elements[c],!0)}},Ether.Ether.prototype.createCoreElement=function(){var a=new Ether.Element("core");a.x=this.x,a.y=this.y,this.coreElements.push(a)},Ether.Ether.prototype.increaseMass=function(a){this.createCoreElement(),this.mass+=1,this.range+=a.radius/2},Ether.Ether.prototype.decreaseMass=function(a){this.coreElements.length>1&&this.coreElements.pop(),this.mass>0&&(this.mass-=1),this.range>2&&(this.range-=a.radius/2)},Ether.Ether.prototype.receiveAward=function(a){this.currentSpan+a>this.lifeSpan[0]?this.currentSpan=this.lifeSpan[0]:this.currentSpan+=a},Ether.Ether.prototype.isGameOver=function(){0==this.elements.length&&(this.engine.gameOver=!0)},Ether.Ether.prototype.checkZoom=function(){this.isAtScreenEdge()&&!this.canZoom&&(console.log("At Screen Edge"),this.engine.hub.zoomMessageShown||(this.engine.hub.zoomMessage0="See (Z)oom in the lower-right corner."),this.canZoom=!0)},Ether.Ether.prototype.isAtScreenEdge=function(){return this.x+1.5*this.range>this.engine.width?!0:this.y+1.5*this.range>this.engine.height?!0:void 0},Ether.Ether.prototype.getMoreScreen=function(a){0!=this.zoomCounter&&a>this.zoomLastTime+this.zoomDelay?(this.zoomLastTime=a,this.zoomCounter-=1,this.zoomOut(this.zoomStep),this.engine.world.zoomOutBackground(1.25),this.engine.world.zoomOutElements(this.zoomStep)):0==this.zoomCounter&&(this.canZoom=!1,this.zooming=!1,this.zoomCounter=this.zoomCounterMax,this.engine.hub.zoomTimeout=100)},Ether.Ether.prototype.zoomOut=function(a){this.range=Math.round(this.range/a),this.zoom=Math.round(this.zoom+a);for(var b=0;b<this.elements.length;b++){var c=this.elements[b];c.radius=Math.round(c.radius/a),c.xOffset=Math.round(c.xOffset/a),c.yOffset=Math.round(c.yOffset/a)}for(var b=0;b<this.coreElements.length;b++)this.coreElements[b].radius=Math.round(this.coreElements[b].radius/a)},Ether.Ether.prototype.rotateElement=function(a,b){b>this.rotateLastTime+100&&(this.rotateDirection<0?(this.degreeChange+=.001,this.degreeChange>1&&(this.degreeChange=1,this.rotateDirection++)):this.rotateDirection>0?(this.degreeChange-=.001,this.degreeChange<.001&&(this.degreeChange=.001)):this.dying&&this.rotateDirection++),360==a.degree?a.degree=0:a.degree+=this.degreeChange,a.xOffset=a.range*Math.cos(this.util.degToRad(a.degree)),a.yOffset=a.xOffset*Math.tan(this.util.degToRad(a.degree)),this.dead&&(this.loseElements(1),this.isGameOver())},Ether.Ether.prototype.createSludge=function(a,b){if(this.dead)this.blowUpElements(b);else if(b>this.sludgeLastTime+this.sludgeTimeOffset){this.sludgeLastTime=b;for(var c=new Sludge(this.engine,this),d=0;d<this.elements.length;d++){var a=this.elements[d];this.xv>0&&a.x>this.x?this.pushSludge(c,a):this.xv<0&&a.x<this.x?this.pushSludge(c,a):this.yv>0&&a.y>this.y?this.pushSludge(c,a):this.yv<0&&a.y<this.y&&this.pushSludge(c,a)}this.engine.ethers.push(c)}},Ether.Ether.prototype.pushSludge=function(a,b){var c=new Ether.Element(0,0,b);a.elements.push(c)},Ether.Ether.prototype.blowUpElements=function(a){if(a>this.blowUpTime+100){this.blowUpTime=a;var b=5-this.blownUpElements.length;if(0!=this.elements.length&&b>0){var c=Math.floor(Math.random()*this.elements.length);this.igniteElement(this.elements[c])}for(var d=0;d<this.blownUpElements.length;d++){var e=this.blownUpElements[d];this.blowUpElement(e)&&d--}this.isGameOver()}},Ether.Ether.prototype.blowUpElement=function(a){if(a.rgb.a>0)a.rgb.a-=.01,a.rgb.a<0&&(a.rgb.a=0),a.radius+=2,a.color="rgba("+a.rgb.r+","+a.rgb.g+","+a.rgb.b+","+a.rgb.a+")";else if(0==a.rgb.a){this.removeFromElementCount(a),this.decreaseMass(a);for(var b=0;b<this.elements.length;b++){var c=this.elements[b];if(c.x==a.x&&c.y==a.y)return this.blownUpElements.splice(0,1),this.elements.splice(b,1),!0}}},Ether.Ether.prototype.igniteElement=function(a){this.blownUpElements.push(a)},Ether.Ether.prototype.save=function(){console.log("save")},Ether.Trophy=function(){this.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,this.IDBTransaction=window.IDBTransaction||window.webkitIDBTransaction||window.msIDBTransaction,this.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange||window.msIDBKeyRange,this.db,this.newEther,this.indexedDB||window.alert("Your browser doesn't support IndexedDB. Please update to get the most out of this game.")},Ether.Trophy.prototype.extractEtherInfo=function(a){var b={};return b.elements=a.elements,b.coreElements=a.coreElements,b},Ether.Trophy.prototype.init=function(){var a=this.indexedDB.open("PastEther",1);a.onerror=function(){alert("Why didn't you allow my web app to use IndexedDB?!")},a.onsuccess=function(){this.db=a.result;db.transaction();if(console.log(this.db.transaction.objectStore),console.log(this.db.transaction.objectStore("ether")),!this.db.transaction.objectStore("ether")){console.log("inside if statement"),console.log(this.db.createObjectStore);var b=this.db.createObjectStore("ether",{autoIncrement:!0});console.log("object store made"),b.createIndex("elements","elements"),b.createIndex("coreElements","coreElements"),console.log("index created")}console.log("end on request success")}},Ether.Trophy.prototype.save=function(a){console.log("in save");var b=this.extractEtherInfo(a),c=db.transaction("Ether","readwrite").objectStore("Ether");c.add(b),console.log(c)},Ether.World=function(a){this.engine=a,this.util,this.player,this.width=100*a.width,this.height=100*a.height,this.x=a.width/2,this.y=a.height/2,this.xv=0,this.yv=0,this.dragLastTime=0,this.speedUp={},this.speedUp.x=!1,this.speedUp.y=!1,this.fire=[],this.water=[],this.earth=[],this.air=[],this.elements=[this.earth,this.air,this.fire,this.water],this.driftArray=[],this.sizeOffset=5e3,this.farBackground=[],this.midGround=[],this.NumberOfStars=4,this.badToggle=0},Ether.World.prototype.init=function(a){var b=["earth","air","fire","water"];this.player=a.ethers[0],this.util=a.util,this.initBackground();for(var c=0;c<this.elements.length;c++){var d=this.elements[c],e=b[c];this.initElements(e,d,[60,350,500],[3,50,300],[5e3,300,100],[40500,600,300]),this.initBadGuys(e,d,120,!0)}},Ether.World.prototype.initElements=function(a,b,c,d,e,f){for(var g=0;g<e.length;g++)this.initElement(a,b,e[g],f[g],function(a){c[g]&&a.radius>c[g]&&(a.radius=c[g]),d[g]&&a.radius<d[g]&&(a.radius=d[g])})},Ether.World.prototype.initBadGuys=function(a,b,c,d){var e=d||this.engine.badGuys;e&&this.initElement(a,b,30,1,function(a){(a.radius>c||a.radius<c)&&(a.radius=c)},!0)},Ether.World.prototype.initElement=function(a,b,c,d,e,f){for(var g=0;c>g;g++){var h=(2*Math.random()*this.width-this.width)/2,i=(2*Math.random()*this.height-this.height)/2,j=this.getDistanceFromCenter({x:h,y:i}),k=new Ether.Element(a,j/d,{},f);e(k),k.xOffset=h,k.yOffset=i;{k.xOffset+this.x,k.yOffset+this.y}b.push(k)}},Ether.World.prototype.initBackground=function(){for(var a=0;3>a;a++){this.farBackground[a]=[];for(var b=0;3>b;b++)this.farBackground[a][b]=new Image,this.farBackground[a][b].src="imgs/background.jpg",this.farBackground[a][b].xPos=1356*a-1356,this.farBackground[a][b].yPos=1356*b-1356}for(var a=0;a<this.NumberOfStars;a++)this.midGround[a]=new Image,this.midGround[a].src="imgs/star"+a+".png",this.midGround[a].xPos=Math.round(Math.random()*this.engine.width*6)-3*this.engine.width,this.midGround[a].yPos=Math.round(Math.random()*this.engine.height*6)-3*this.engine.height},Ether.World.prototype.draw=function(a,b){this.engine.isPaused?(this.xv=0,this.yv=0):(this.xv=this.adjustVelocity("x",this.xv,b),this.yv=this.adjustVelocity("y",this.yv,b)),b>this.dragLastTime+200&&(this.dragLastTime=b),this.drawBackground(this.xv,this.yv),this.engine.isPaused||(this.x+=this.xv,this.y+=this.yv,this.player.xv=this.xv,this.player.yv=this.yv,a.xv=this.xv,a.yv=this.yv);for(var c=0;c<this.elements.length;c++)for(var d=this.elements[c],e=0;e<d.length;e++){var f=d[e];if(this.isInView(f)){f.jitter*=-1,f.x=this.x+f.xOffset+f.jitter,f.y=this.y+f.yOffset,this.driftTowardsEther(f),a.ctx.beginPath();var g=a.ctx.createRadialGradient(f.x,f.y,0,f.x,f.y,f.radius);f.bad?this.util.createGradient(g,[[.1,"rgba("+Math.round(255*Math.random())+","+Math.round(255*Math.random())+","+Math.round(255*Math.random())+",1)"],[.3,"black"],[.7,"black"],[.9,"rgba("+Math.round(255*Math.random())+","+Math.round(255*Math.random())+","+Math.round(255*Math.random())+",1)"]]):this.util.createGradient(g,[[.1,"white"],[.1,"white"],[.8,f.color],[.1,"black"]]),a.ctx.fillStyle=g,a.ctx.arc(f.x,f.y,f.radius,2*Math.PI,!1),a.ctx.fill(),this.isInRangeOfEther(f,c,e)}}this.drawDriftingElements(a),this.drawBorder(a)},Ether.World.prototype.zoomOutBackground=function(a){for(var b=0;b<this.midGround.length;b++){var c=this.midGround[b];c.width/=a,c.height/=a}},Ether.World.prototype.zoomOutElements=function(a){for(var b=0;b<this.elements.length;b++)for(var c=0;c<this.elements[b].length;c++)this.elements[b][c].radius/=a},Ether.World.prototype.drawBackground=function(a,b){for(var c=Math.ceil(a/10),d=Math.ceil(b/10),e=Math.ceil(a/5),f=Math.ceil(b/5),g=this.engine.width,h=this.engine.height,i=0;i<this.farBackground.length;i++)for(var j=this.farBackground[i],k=0;k<j.length;k++){var l=j[k];l.xPos+=c,l.yPos+=d,l.xPos+2*l.width<=0?l.xPos=g:l.xPos>=2*l.width&&(l.xPos=-l.width),l.yPos+2*l.height<=0?l.yPos=h:l.yPos>=2*l.height&&(l.yPos=-l.height),this.engine.ctx.drawImage(l,l.xPos,l.yPos)}for(var i=0;i<this.midGround.length;i++){var m=this.midGround[i];m.xPos+=e,m.yPos+=f,m.xPos<3*-g?(m.yPos=Math.round(Math.random()*h*6)-3*h,m.xPos=3*g-m.width):m.xPos>3*g&&(m.yPos=Math.round(Math.random()*h*6)-3*h,m.xPos=3*-g),m.yPos<3*-h?(m.xPos=Math.round(Math.random()*g*6)-3*g,m.yPos=3*h-m.height):m.yPos>3*h&&(m.xPos=Math.round(Math.random()*g*6)-3*g,m.yPos=3*-h),this.engine.ctx.drawImage(m,m.xPos,m.yPos)}},Ether.World.prototype.driftTowardsEther=function(a){if(!this.engine.isPaused){var b,c=this.player,d=Math.round(2*a.radius*c.attraction+c.range+10);if(b=a.bad?c.speed-c.resistance:Math.round(c.force/a.radius*100)/100,a.bad||this.util.getDistanceFromCenter(a,c)<=d)for(var e;!e;){var f=Math.floor(4*Math.random());switch(f){case 0:a.x<c.x+5&&(a.xOffset+=b,e=!0);break;case 1:a.x>c.x-5&&(a.xOffset-=b,e=!0);break;case 2:a.y<c.y+5&&(a.yOffset+=b,e=!0);break;case 3:a.y>c.y-5&&(a.yOffset-=b,e=!0)}}}},Ether.World.prototype.removeBadElements=function(){for(var a=0;a<this.elements.length;a++)for(var b=this.elements[a],c=0;c<b.length;c+=1){var d=b[c];d.bad&&(b.splice(c,1),c-=1)}},Ether.World.prototype.drawBorder=function(a){a.ctx.fillStyle="white",this.borderX=this.x-this.width/2,this.borderY=this.y-this.height/2,this.borderW=this.width,this.borderH=this.height,a.ctx.strokeRect(this.borderX,this.borderY,this.borderW,this.borderH)},Ether.World.prototype.drawDriftingElements=function(a){for(var b=0;b<this.driftArray.length;b++){var c=this.driftArray[b];c.xOffset+=c.jitter*c.radius/2;var d=this.x+c.xOffset,e=this.y+c.yOffset;a.ctx.beginPath();var f=a.ctx.createRadialGradient(d,e,0,d,e,c.radius);if(a.ctx.fillStyle=this.util.createGradient(f,[[.1,"white"],[.1,"white"],[.8,c.color],[.1,"black"]]),a.ctx.arc(d,e,c.radius,2*Math.PI,!1),a.ctx.fill(),c.newElement)c.newElement--;else{var g="earth"==c.type?0:"air"==c.type?1:"fire"==c.type?2:"water"==c.type?3:void 0;c.jitter/=5,this.driftArray.splice(b,1),b--,this.elements[g].push(c)}}},Ether.World.prototype.isInRangeOfEther=function(a,b,c){if(this.isInView(a)){var d=this.player,e=d.range+a.radius/2,f=a.xOffset+this.x,g=a.yOffset+this.y,h=d.getDistanceFromCenter({x:f,y:g});a.bad&&(d.enemySeen=!0),e>h&&(a.bad?this.badToggle>2*this.player.resistance?(this.badToggle=0,this.engine.audio.playElementSound(a),d.loseElements(2)):this.badToggle+=1:(a.x=f,a.y=g,d.newElement(a),this.elements[b].splice(c,1)))}},Ether.World.prototype.isInView=function(a){var b=a.xOffset+this.x,c=a.yOffset+this.y;return b>-a.radius&&b<this.engine.width+a.radius&&c>-a.radius&&c<this.engine.height+a.radius?!0:void 0},Ether.World.prototype.getDistanceFromCenter=function(a){return this.engine.util.getDistanceFromCenter(a,this)},Ether.World.prototype.adjustVelocity=function(a,b,c){return c>this.dragLastTime+200&&(this.speedUp[a]?b>0&&b<=this.player.speed?(b+=2,b>this.player.speed&&(b=this.player.speed)):0>b&&b>=-this.player.speed&&(b-=2,b<-this.player.speed&&(b=-this.player.speed)):0!=b&&(b>0?(b-=2,0>b&&(b=0)):0>b&&(b+=2,b>0&&(b=0)))),b},Ether.World.prototype.handleKeyDown=function(a){var b=this.player.getControl();switch(a){case 87:case 38:!this.speedUp.y&&this.yv>=-b?(this.speedUp.y=!0,this.yv=1):this.yv<-b&&(this.speedUp.y=!1),this.player.moved=!0;break;case 68:case 39:!this.speedUp.x&&this.xv<=b?(this.speedUp.x=!0,this.xv=-1):this.xv>b&&(this.speedUp.x=!1),this.player.moved=!0;break;case 83:case 40:!this.speedUp.y&&this.yv<=b?(this.speedUp.y=!0,this.yv=-1):this.yv>b&&(this.speedUp.y=!1),this.player.moved=!0;break;case 65:case 37:!this.speedUp.x&&this.xv>=-b?(this.speedUp.x=!0,this.xv=1):this.xv<-b&&(this.speedUp.x=!1),this.player.moved=!0}},Ether.World.prototype.handleKeyUp=function(a){switch(a){case 38:case 87:this.speedUp.y=!1;break;case 68:case 39:this.speedUp.x=!1;break;case 40:case 83:this.speedUp.y=!1;break;case 37:case 65:this.speedUp.x=!1}},Ether.World.prototype.handleTouch=function(a){console.log(a.changedTouches)},Ether.World.prototype.handleTouchEnd=function(a){console.log(a.changedTouches)},Ether.World.prototype.newElement=function(a){var b=this.player;a.xOffset=a.x-this.x,a.yOffset=a.y-this.y,a.newElement=10,a.jitter*=4,(a.x<b.x&&a.jitter>0||a.x>b.x&&a.jitter<0)&&(a.jitter*=-1),this.driftArray.push(a)},Ether.Hub=function(a){var b=this;this.engine=a,this.unit=a.width/50,this.showInfo=!0,this.lastTime=0,this.messageExist=!1,this.currentMessage="",this.lastMessageTime=0,this.msgQue=new Ether.MsgQue,this.intro=!0,this.lastIntroTime=0,this.introAlpha=0,this.introText=["an ether is born","you are born","collect the four elements","grow into yourself","and die","as all things that are born must","seek balance"],this.introIndex=0,this.timeOffset=0,this.zoomTimeout=100,this.zoomLastTime=0,this.zoomMessage="",this.zoomMessageShown=!1,this.zoomMessage0="",this.zoomMessage1="It means you can zoom out.",this.zoomMessage2="Press Z to zoom out",this.awardMssg="",this.lifeStageMssg="",this.lifeStageOpts=["spread your wings","spread your trail"],this.subMessage="",this.gameOverLastTime=0,this.gameOverAlpha=0,this.gameOverWidth,this.gameOverColor="rgba(0,0,0,",this.lifeSpanMssgShown=!1,this.stableWarned=!1,this.stableMssg0="Vibration is a sign of imbalance.",this.stableMssg1="You will purge yourself if BALANCE falls below 50.",this.purgeMssg="PURGING",this.purgeNotified=!1,this.unstable=!1,this.firstElementMessage0="You have acquired your first element.",this.firstElementMessage11="New elements change your BALANCE.",this.firstElementMessage10="Don't let it become too low (< 50).",this.firstElementShown=!1,this.lifeBarMessage0="Your lifespan is represented at the top of the screen.",this.lifeBarMessage1="When it runs out, you will die.",this.enemyMessage0="Rainbow Voids will purge you of all your elements.",this.enemyMessage1=" Stay away from them.",this.enemyMessageShown=!1,this.bigElementMessageShowing=!1,this.bigElementMessageShown=!1,this.bigElementSub="CAREFUL!",this.bigElementMessage="Large elements can cause a sudden imbalance.",this.upgradeMessageShown=!1,this.upgradeAvailable=!1,this.upgradeMessage0="See (U)pgrades in the lower-right corner.",this.upgradeMessage1="It means you have an available upgrade.",this.upgradeMessage2="Press 'U' to access upgrades.",this.mousemove=function(a){{var c=a.x;a.y}return b.gameOverWidth?void(b.gameOverColor="rgba(255,0,0,"!=b.gameOverColor&&a.x>b.engine.width-2*b.gameOverWidth&&a.y>b.engine.height-2*b.gameOverWidth?"rgba(255,0,0,":"rgba(255,255,255,"):void(c<=b.engine.width/2?(b.choice1Alpha=.5,b.choice2Alpha=.2):(b.choice1Alpha=.2,b.choice2Alpha=.5))},this.handleClick=function(a){return b.gameOverWidth?void(a.x>b.engine.width-2*b.gameOverWidth&&a.y>b.engine.height-2*b.gameOverWidth&&(window.location.href="index.html")):void(b.introIndex+1<b.introText.length&&(b.timeOffset=b.lastIntroTime,b.introIndex++,b.introIndex!=b.introText.length-1&&(b.introAlpha=0)))},this.handleKeyDown=function(){b.question>3&&b.introIndex+1<b.introText.length&&(b.timeOffset=b.lastIntroTime,b.introIndex++,b.introIndex!=b.introText.length-1&&(b.introAlpha=0))}},Ether.Hub.prototype.init=function(){window.onmousemove=this.mousemove,window.onclick=this.handleClick},Ether.Hub.prototype.drawIntro=function(a){var b=this.engine.ctx;this.drawIntroText(b,a)},Ether.Hub.prototype.drawIntroText=function(a,b){b>this.lastIntroTime+50&&(a.font="28pt simple",a.fillStyle="rgba(164,161,151,"+this.introAlpha+")",this.introAlpha+=.1,this.lastIntroTime=b,this.introAlpha>1&&(this.introAlpha=1),this.lastIntroTime-this.timeOffset>3e3&&(this.timeOffset=this.lastIntroTime,this.introAlpha=0,this.introIndex++,this.introIndex==this.introText.length&&(this.intro=!1)));var c=this.introText[this.introIndex],d=a.measureText(c).width;a.fillStyle="rgba(255,255,255,"+this.introAlpha+")",a.fillText(c,this.engine.width/2-d/2,this.engine.height/2)},Ether.Hub.prototype.draw=function(a){var b=this.engine.ctx,c=this.getStats(),d=this.drawBalance(c.stab,b);this.drawElementStats(c.elementCount,b,d),this.drawLifeBar(b,a),this.updateMsgQue(),this.drawMessage(b,a),this.drawZoom(b,a),this.drawUpgrade(b,a)},Ether.Hub.prototype.drawZoom=function(a){this.engine.player.moved&&(a.fillStyle=this.engine.player.canZoom?"#A3C2C2":"rgba(65,78,78,.2)",a.font=1.5*this.unit+"px simple",a.fillText("(Z)oom Out",this.engine.width-8*this.unit,this.engine.height-2.5*this.unit))},Ether.Hub.prototype.drawUpgrade=function(a){this.engine.player.moved&&(this.engine.upgrade.canUpgrade()?(this.upgradeAvailable=!0,a.fillStyle="#A3C2C2"):a.fillStyle="rgba(65,78,78,.2)",a.font=1.5*this.unit+"px simple",a.fillText("(U)pgrades",this.engine.width-8*this.unit,this.engine.height-this.unit))},Ether.Hub.prototype.newAward=function(a,b){this.awardMssg=[a,b]},Ether.Hub.prototype.getStats=function(){var a={},b=this.engine.ethers[0];return a.mass=b.mass,a.stab=b.getStability(),a.elementCount=b.getElementCount(),a.range=b.range,a},Ether.Hub.prototype.drawBalance=function(a,b){var c=a>100?0:100-a;return b.font=2*this.unit+"px simple",b.fillStyle="#414E4E",b.fillText("Balance: "+c,.9*this.unit-2,this.engine.height-1.2*this.unit-2),b.fillStyle="#A3C2C2",b.fillText("Balance: "+c,.9*this.unit,this.engine.height-1.2*this.unit),this.unit
},Ether.Hub.prototype.drawElementStats=function(a,b,c){b.font=this.unit+"px simple";var d=b.measureText("Fire: "+a.f).width,e=b.measureText("Air: "+a.a).width,f=d>=e?d:e;b.fillStyle="#6B504A",b.fillText("Fire: "+a.f,c-1,this.engine.height-4.5*this.unit-1),b.fillStyle="#E0664A",b.fillText("Fire: "+a.f,c,this.engine.height-4.5*this.unit),b.fillStyle="#243F63",b.fillText("Water: "+a.w,c+f+2*this.unit-1,this.engine.height-4.5*this.unit-1),b.fillStyle="#47BDDE",b.fillText("Water: "+a.w,c+f+2*this.unit,this.engine.height-4.5*this.unit),b.fillStyle="#9E9E99",b.fillText("Air: "+a.a,c-1,this.engine.height-3*this.unit-1),b.fillStyle="#EDEDEB",b.fillText("Air: "+a.a,c,this.engine.height-3*this.unit),b.fillStyle="#858063",b.fillText("Earth: "+a.e,c+f+2*this.unit-1,this.engine.height-3*this.unit-1),b.fillStyle="#6C7F2E",b.fillText("Earth: "+a.e,c+f+2*this.unit,this.engine.height-3*this.unit);var g=this.getEqualitySign(a.f,a.w),h=this.getEqualitySign(a.a,a.e);b.fillStyle="#414E4E",b.fillText(g,c+f+.75*this.unit-1,this.engine.height-4.5*this.unit-1),b.fillText(h,c+f+.75*this.unit-1,this.engine.height-3*this.unit-1),b.fillStyle="#A3C2C2",b.fillText(g,c+f+.75*this.unit,this.engine.height-4.5*this.unit),b.fillText(h,c+f+.75*this.unit,this.engine.height-3*this.unit)},Ether.Hub.prototype.getEqualitySign=function(a,b){return a>b?">":b>a?"<":"="},Ether.Hub.prototype.drawLifeBar=function(a,b){var c=this.engine.ethers[0],d=c.currentSpan/c.lifeSpan[0],e=this.getLifeBarColor(d);a.fillStyle="#FFF4E9",a.font=this.unit+"px simple";var f=a.measureText("Lifespan").width;a.fillText("Lifespan",this.engine.width/2-f/2,this.unit),a.fillStyle=e,a.fillRect(this.engine.width-2*this.unit,1.5*this.unit,-(46*this.unit)*d,.5*this.unit),a.strokeStyle="red",a.strokeRect(2*this.unit,1.5*this.unit,46*this.unit,.5*this.unit),c.moved&&b>this.lastTime+1e3&&!c.inVoid&&!this.engine.isPaused&&(this.lastTime=b,d>0?c.currentSpan--:c.dead=!0)},Ether.Hub.prototype.getLifeBarColor=function(a){return.25>=a?"red":.5>=a?"orange":.75>=a?"yellow":"green"},Ether.Hub.prototype.drawMessage=function(a,b){this.engine.ethers[0];if(!this.messageExist||this.messageExist&&!this.msgQue.hasMsg())if(this.msgQue.hasMsg()){var c=this.msgQue.getMsg();switch(this.messageExist=!0,this.currentMessage=c,c.type){case"blank":c.alphaStep=1,c.alphaTime=1,c.fontSize=1;break;case"award":c.fontSize=2.5,this.subMessage=c.sub,this.engine.audio.playSound("life");break;case"tutorial":Ether.Tutorial?(this.engine.isPaused=!0,c.alphaTime=5e3,c.alphaStep=1,c.fontSize=2):(this.messageExist=!1,this.currentMessage="");break;case"purge":c.fontSize=3,this.engine.audio.playSound("purge");break;case"stability":c.fontSize=2;break;case"default":c.fontSize=2}}else this.renderMessage(a,b);else this.renderMessage(a,b)},Ether.Hub.prototype.updateMsgQue=function(){var a={};this.lifeSpanMssgShown?this.engine.player.receivedFirstElement&&!this.firstElementShown?(this.addBlankMsg(),a.type="tutorial",a.alphaStep=.015,a.string=this.firstElementMessage0,this.msgQue.addMsg(a),a.alphaStep=void 0,a.string=this.firstElementMessage11,this.msgQue.addMsg(a),a.string=this.firstElementMessage10,this.msgQue.addMsg(a),this.firstElementShown=!0):!this.upgradeMessageShown&&this.upgradeAvailable?(this.addBlankMsg(),a.type="tutorial",a.string=this.upgradeMessage0,this.msgQue.addMsg(a),a.string=this.upgradeMessage1,this.msgQue.addMsg(a),a.string=this.upgradeMessage2,this.msgQue.addMsg(a),this.upgradeMessageShown=!0):this.engine.player.unstable&&this.engine.player.bigElementIncrease&&!this.bigElementMessageShown?(this.addBlankMsg(),a.string=this.bigElementMessage,a.sub=this.purgeMssg,a.type="tutorial",this.msgQue.addMsg(a),this.engine.player.bigElementIncrease=!1,this.bigElementMessageShowing=!0,this.bigElementMessageShown=!0):!this.engine.player.unstable||this.bigElementMessageShowing||this.purgeNotified||this.stableWarned?!this.enemyMessageShown&&this.engine.player.enemySeen?(this.addBlankMsg(),a.type="tutorial",a.string=this.enemyMessage0,this.msgQue.addMsg(a),a.string=this.enemyMessage1,this.msgQue.addMsg(a),this.enemyMessageShown=!0):this.zoomMessageShown||""==this.zoomMessage0?this.engine.player.unstable?this.bigElementMessageShowing||!this.engine.player.purging||this.purgeNotified||(a.string=this.purgeMssg,a.type="purge",this.msgQue.addMsg(a),this.purgeNotified=!0,this.engine.player.purging=!1):this.awardMssg?(a.string=this.awardMssg[0],a.type="award",a.sub="+"+this.awardMssg[1]+" Lifespan",this.msgQue.addMsg(a),this.awardMssg=""):""!=this.lifeStageMssg&&(a.string=this.lifeStageMssg,a.type="transform",this.msgQue.addMsg(a),this.lifeStageMssg=""):(a.type="tutorial",a.string=this.zoomMessage0,this.msgQue.addMsg(a),a.string=this.zoomMessage1,this.msgQue.addMsg(a),a.string=this.zoomMessage2,this.msgQue.addMsg(a),this.zoomMessage="",this.zoomMessageShown=!0):(this.addBlankMsg(),a.type="tutorial",this.stableWarned=!0,a.string=this.stableMssg0,this.msgQue.addMsg(a),a.string=this.stableMssg1,this.msgQue.addMsg(a)):(this.addBlankMsg(),a.type="tutorial",a.string=this.lifeBarMessage0,this.msgQue.addMsg(a),a.string=this.lifeBarMessage1,this.msgQue.addMsg(a),this.lifeSpanMssgShown=!0)},Ether.Hub.prototype.addBlankMsg=function(){config={},config.type="blank",config.string="",this.msgQue.addMsg(config)},Ether.Hub.prototype.renderMessage=function(a,b){if(""!=this.currentMessage){var c=(this.engine.ethers[0],this.currentMessage.str),d=this.currentMessage.sub,e=this.currentMessage.fill,f=this.currentMessage.fontSize;if(a.font=f*this.unit+"px simple","function"!=typeof a.measureText)return void console.log(a);var g=a.measureText(c).width;g>this.engine.width-10&&"award"==this.currentMessage.type&&(a.font=1.5*this.unit+"px simple",g=a.measureText(c).width);var h=this.engine.width/2-g/2,i=this.engine.height/2-this.unit;if(a.fillStyle="rgba(0,0,0,"+this.currentMessage.alpha+")",a.fillText(c,h+2,i+2),a.fillStyle=e+this.currentMessage.alpha+")",a.fillText(c,h,i),""!=d&&(a.font=this.unit+"px simple",g=a.measureText(d).width,h=this.engine.width/2-g/2,a.fillStyle="rgba(0,0,0,"+this.currentMessage.alpha+")",a.fillText(d,h+2,i-3*this.unit+2),a.fillStyle=e+this.currentMessage.alpha+")",a.fillText(d,h,i-3*this.unit)),b>this.lastMessageTime+this.currentMessage.alphaTime){if(this.currentMessage.lowerAlpha()<.3){switch(this.messageExist=!1,this.currentMessage.type){case"purge":this.purgeNotified=!1;break;case"bigElement":this.bigElementMessageShowing=!1;break;case"tutorial":this.engine.isPaused=!1}this.currentMessage.alpha<=0&&(this.currentMessage="")}this.lastMessageTime=b}}},Ether.Hub.prototype.hasLeftBorder=function(){var a=this.engine.ethers[0],b=this.engine.world;return a.x<=b.borderX||a.y<=b.borderY||a.x>=b.vorderX+b.borderW||a.y>=b.borderY+b.borderH?(a.inVoid=!0,!0):void(a.inVoid=!1)},Ether.Hub.prototype.gameOver=function(a,b){b>this.gameOverLastTime+100&&1!=this.gameOverAlpha&&(this.gameOverAlpha+=.02,this.gameOverAlpha>1&&(this.gameOverAlpha=1)),a.fillStyle=this.gameOverColor+this.gameOverAlpha+")",a.font="1em Courier";var c="Restart";this.gameOverWidth=a.measureText(c).width,a.fillText(c,this.engine.width-1.5*this.gameOverWidth,this.engine.height-10)},Ether.Audio=function(){this.engine,this.ctx,this.audio={}},Ether.Audio.prototype.init=function(){this.loadSounds()},Ether.Audio.prototype.loadSounds=function(a){var b=["fire","water","air","earth","life","upgrade","purge","nope"],a=a||0,c=this,d=b[a];this.audio[d]=new Audio("audio/"+d+".wav"),a!=b.length-1?(a++,c.loadSounds(a)):c.loaded=!0},Ether.Audio.prototype.playElementSound=function(a){var b=a.bad?1:a.radius/125;b>1&&(b=1),this.audio[a.type].volume=b,this.audio[a.type].play()},Ether.Audio.prototype.playSound=function(a,b){this.muteOtherSound();var c=b||.8;this.audio[a].volume=c,this.audio[a].play()},Ether.Audio.prototype.muteOtherSound=function(){for(var a in this.audio)this.audio[a].ended||this.audio[a].pause()},Ether.Upgrade=function(a){var b=this;this.engine=a,this.player,this.upgradeCheck={w:[13],f:[13],a:[13],e:[]},this.container=document.getElementById("upgrade"),this.cy=cytoscape({container:b.container,elements:b.getNodes().concat(b.edges),style:b.style,layout:{name:"breadthfirst",roots:"#nparent"},ready:function(a){var c=a.cy;c.elements("node").data("activated",!1),c.elements("node[id='nparent']").data("activated",!0),c.elements("node[id='nparent']").addClass("activated"),b.addData(c),c.elements("node").addClass("unactive"),c.on("click","node",function(a){b.isUpgradable(a.cyTarget)&&b.hasEnoughEnergy(a.cyTarget)?(a.cyTarget.data("activated",!0),c.elements('node[id = "'+a.cyTarget.id()+'"]').removeClass("showingInfo"),a.cyTarget.addClass("activated"),b.handleClick(a.cyTarget)):b.engine.audio.playSound("nope")}),c.on("mouseover","node",function(a){var d=a.cyTarget;b.isUpgradable(d)?c.elements('node[id = "'+d.id()+'"]').addClass("showingInfo"):d.data().activated||c.elements('node[id = "'+d.id()+'"]').addClass("notActive")}),c.on("mouseout","node",function(a){var d=a.cyTarget;b.isUpgradable(d)?c.elements('node[id = "'+d.id()+'"]').removeClass("showingInfo"):d.data("activated")||c.elements('node[id = "'+d.id()+'"]').removeClass("notActive")}),b.container.style.display="none"},zoomingEnabled:!1,panningEnabled:!1})},Ether.Upgrade.prototype.init=function(){this.container.style.height=window.innerHeight,this.player=this.engine.ethers[0]},Ether.Upgrade.prototype.hasEnoughEnergy=function(a){var b=this.player.getElementCount(),c=a.data("cost"),d=a.id().split(".")[0];return"attraction"==d&&b.f>=c?(b.f-=c,!0):"resistance"==d&&b.e>=c?(b.e-=c,!0):"balance"==d&&b.a>=c?(b.a-=c,!0):"movement"==d&&b.w>=c?(b.w-=c,!0):0==d.indexOf("T")&&b.f>=c&&b.w>=c&&b.e>=c&&b.a>=c?(b.f-=c,b.e-=c,b.a-=c,b.w-=c,!0):void 0},Ether.Upgrade.prototype.addData=function(a){for(var b in a.elements("node")){var c=a.elements("node")[b];if(c&&c.data&&!c.data("activated")){var d=parseInt(c.id().split(".")[1]),e=c.id().split(".")[0].charAt(0).toUpperCase()+c.id().split(".")[0].slice(1);switch(c.data("cost",d*(7+d)),e.toLowerCase()){case"movement":c.data("info",e+" : "+d*(12+d)+" : Water");break;case"resistance":c.data("info",e+" : "+d*(12+d)+" : Earth");break;case"attraction":c.data("info",e+" : "+d*(12+d)+" : Fire");break;case"balance":c.data("info",e+" : "+d*(12+d)+" : Air");break;case"tsnail":case"tbutterfly":var f=e.length,g=e.slice(1,f),h=g.charAt(0).toUpperCase()+g.slice(1);c.data("info",h+" : "+Math.round(d*(12+d)/1.3))}}}},Ether.Upgrade.prototype.isUpgradable=function(a){if(1==a.data().activated)return!1;var b=a.id(),c=[],d=!1;for(var e in a.connectedEdges()){var f=a.connectedEdges()[e];if(f.data){var g=f.data();g.source!=b&&c.push(f)}}if(0==c.length)return!0;for(var e=0;e<c.length;e++){var f=c[e],h=f.source();h.data().activated&&(d=h.data().activated)}return d},Ether.Upgrade.prototype.handleClick=function(a){var b=a.id().split("."),c=b[0],d=a.data("cost"),e={string:"",type:"upgrade",alphaStep:.03};switch(c){case"movement":this.player.control+=10,this.player.speed+=1,this.upgradeCheck.w.shift(),e.fill="rgba(71,189,222,",e.sub="- "+d+" water",this.engine.hub.msgQue.addMsg(e);break;case"balance":this.player.balance+=.5,this.upgradeCheck.a.shift(),e.fill="rgba(237,237,235,",e.sub="- "+d+" air",this.engine.hub.msgQue.addMsg(e);break;case"attraction":this.player.attraction+=3/7,this.player.force-=50/7,this.upgradeCheck.f.shift(),e.fill="rgba(224,102,74,",e.sub="- "+d+" fire",this.engine.hub.msgQue.addMsg(e);break;case"resistance":this.player.resistance+=1,this.upgradeCheck.e.shift(),e.fill="rgba(108,127,46,",e.sub="- "+d+" earth",this.engine.hub.msgQue.addMsg(e);break;case"Tsnail":this.player.transformation=this.player.transformations.snail;break;case"Tbutterfly":this.player.transformation=this.player.transformations.butterfly}var f=a.connectedEdges();for(i in f){var g=f[i];if(g.target){var h=g.target(),c=h.id().split(".")[0],d=h.data().cost;switch(c){case"movement":this.upgradeCheck.w.push(d);break;case"balance":this.upgradeCheck.a.push(d);break;case"attraction":this.upgradeCheck.f.push(d);break;case"resistance":this.upgradeCheck.e.push(d)}}}this.engine.audio.playSound("upgrade"),this.engine.container.style.display="",this.container.style.display="none",this.engine.upgradeScreen=!1},Ether.Upgrade.prototype.canUpgrade=function(){var a=this.player.getElementCount();return a.w>=this.upgradeCheck.w[0]?!0:a.f>=this.upgradeCheck.f[0]?!0:a.a>=this.upgradeCheck.a[0]?!0:a.e>=this.upgradeCheck.e[0]?!0:!1},Ether.Upgrade.prototype.style=[{selector:'node[id ^= "movement"]',css:{"background-color":"#47BDDE","border-width":"2","border-color":"#243F63",shape:"pentagon",color:"#47BDDE","text-outline-color":"#243F63"}},{selector:'node[id ^= "attraction"]',css:{"background-color":"#E0664A","border-width":"2","border-color":"#6B504A",shape:"heptagon",color:"#E0664A","text-outline-color":"#6B504A"}},{selector:'node[id ^= "resistance"]',css:{"background-color":"#6C7F2E","border-width":"2","border-color":"#858063",color:"#6C7F2E",shape:"rectangle","text-outline-color":"#858063"}},{selector:'node[id ^= "balance"]',css:{"background-color":"#EDEDEB","border-width":"2","border-color":"#9E9E99",color:"#EDEDEB",shape:"triangle","text-outline-color":"#9F9FA0"}},{selector:'node[id ^= "T"]',css:{"background-color":"#FFD700","border-width":"2","border-color":"#8F8F00",color:"#FFD700",shape:"star","text-outline-color":"#8F8F00"}},{selector:"edge",css:{"line-color":"#D1E6E6",width:"4","haystack-radius":"1","target-arrow-color":"#D1E6E6","target-arrow-shape":"triangle"}},{selector:".showingInfo",css:{"font-family":"simple","font-size":"25","text-outline-width":"1",content:"data(info)"}},{selector:".notActive",css:{shape:"ellipse","background-color":"black","border-width":"0"}},{selector:".activated",css:{shape:"ellipse","background-color":"white","border-width":"0"}}],Ether.Upgrade.prototype.getNodes=function(){return[{group:"nodes",data:{id:"nparent"},grabbable:!1},{group:"nodes",data:{id:"Tbutterfly.9"}},{group:"nodes",data:{id:"Tsnail.9"}},{group:"nodes",data:{id:"balance.1"},grabbable:!1},{group:"nodes",data:{id:"movement.1"},grabbable:!1},{group:"nodes",data:{id:"attraction.1"},grabbable:!1},{group:"nodes",data:{id:"movement.2"},grabbable:!1},{group:"nodes",data:{id:"attraction.2"},grabbable:!1},{group:"nodes",data:{id:"resistance.2"},grabbable:!1},{group:"nodes",data:{id:"balance.2"},grabbable:!1},{group:"nodes",data:{id:"movement.3"},grabbable:!1},{group:"nodes",data:{id:"attraction.3"},grabbable:!1},{group:"nodes",data:{id:"resistance.3"},grabbable:!1},{group:"nodes",data:{id:"balance.4"},grabbable:!1},{group:"nodes",data:{id:"resistance.4"},grabbable:!1},{group:"nodes",data:{id:"movement.4"},grabbable:!1},{group:"nodes",data:{id:"attraction.4"},grabbable:!1},{group:"nodes",data:{id:"balance.5"},grabbable:!1},{group:"nodes",data:{id:"resistance.5"},grabbable:!1},{group:"nodes",data:{id:"movement.5"},grabbable:!1},{group:"nodes",data:{id:"attraction.6"},grabbable:!1},{group:"nodes",data:{id:"movement.6"},grabbable:!1},{group:"nodes",data:{id:"balance.6"},grabbable:!1},{group:"nodes",data:{id:"resistance.6"},grabbable:!1},{group:"nodes",data:{id:"resistance.7"},grabbable:!1},{group:"nodes",data:{id:"attraction.7"},grabbable:!1},{group:"nodes",data:{id:"balance.7"},grabbable:!1},{group:"nodes",data:{id:"resistance.8"},grabbable:!1},{group:"nodes",data:{id:"balance.8"},grabbable:!1},{group:"nodes",data:{id:"attraction.8"},grabbable:!1},{group:"nodes",data:{id:"movement.8"},grabbable:!1}]},Ether.Upgrade.prototype.edges=[{group:"edges",data:{id:"movement.t.snail",source:"movement.8",target:"Tsnail.9"}},{group:"edges",data:{id:"attraction.t.snail",source:"attraction.8",target:"Tsnail.9"}},{group:"edges",data:{id:"balance.t.butterfly",source:"balance.8",target:"Tbutterfly.9"}},{group:"edges",data:{id:"resistance.t.butterfly",source:"resistance.8",target:"Tbutterfly.9"}},{group:"edges",data:{id:"parent.1.balance",source:"nparent",target:"balance.1"}},{group:"edges",data:{id:"parent.1.movement",source:"nparent",target:"movement.1"}},{group:"edges",data:{id:"parent.1.attraction",source:"nparent",target:"attraction.1"}},{group:"edges",data:{id:"balance.2.movement",source:"balance.1",target:"movement.2"}},{group:"edges",data:{id:"balance.2.attraction",source:"balance.1",target:"attraction.2"}},{group:"edges",data:{id:"movement.2.attraction",source:"movement.1",target:"attraction.2"}},{group:"edges",data:{id:"movement.2.resistance",source:"movement.1",target:"resistance.2"}},{group:"edges",data:{id:"attraction.2.resistance",source:"attraction.1",target:"resistance.2"}},{group:"edges",data:{id:"attraction.balance",source:"attraction.1",target:"balance.2"}},{group:"edges",data:{id:"movement.3.movement",source:"movement.2",target:"movement.3"}},{group:"edges",data:{id:"attraction.3.movement",source:"attraction.2",target:"movement.3"}},{group:"edges",data:{id:"attraction.3.attraction",source:"attraction.2",target:"attraction.3"}},{group:"edges",data:{id:"resistance.3.attraction",source:"resistance.2",target:"attraction.3"}},{group:"edges",data:{id:"resistance.3.resistance",source:"resistance.2",target:"resistance.3"}},{group:"edges",data:{id:"balance.3.resistance",source:"balance.2",target:"resistance.3"}},{group:"edges",data:{id:"movement.4.balance",source:"movement.3",target:"balance.4"}},{group:"edges",data:{id:"movement.4.resistance",source:"movement.3",target:"resistance.4"}},{group:"edges",data:{id:"attraction.4.resistance",source:"attraction.3",target:"resistance.4"}},{group:"edges",data:{id:"attraction.4.movement",source:"attraction.3",target:"movement.4"}},{group:"edges",data:{id:"resistance.4.movement",source:"resistance.3",target:"movement.4"}},{group:"edges",data:{id:"resistance.4.attraction",source:"resistance.3",target:"attraction.4"}},{group:"edges",data:{id:"balance.5.balance",source:"balance.4",target:"balance.5"}},{group:"edges",data:{id:"resistance.5.balance",source:"resistance.4",target:"balance.5"}},{group:"edges",data:{id:"resistance.5.resistance",source:"resistance.4",target:"resistance.5"}},{group:"edges",data:{id:"movement.5.resistance",source:"movement.4",target:"resistance.5"}},{group:"edges",data:{id:"movement.5.movement",source:"movement.4",target:"movement.5"}},{group:"edges",data:{id:"attraction.5.movement",source:"attraction.4",target:"movement.5"}},{group:"edges",data:{id:"balance.6.attraction",source:"balance.5",target:"attraction.6"}},{group:"edges",data:{id:"balance.6.movement",source:"balance.5",target:"movement.6"}},{group:"edges",data:{id:"resistance.6.movement",source:"resistance.5",target:"movement.6"}},{group:"edges",data:{id:"resistance.6.balance",source:"resistance.5",target:"balance.6"}},{group:"edges",data:{id:"movement.6.balance",source:"movement.5",target:"balance.6"}},{group:"edges",data:{id:"movement.6.resistance",source:"movement.5",target:"resistance.6"}},{group:"edges",data:{id:"attraction.7.resistance",source:"attraction.6",target:"resistance.7"}},{group:"edges",data:{id:"movement.7.resistance",source:"movement.6",target:"resistance.7"}},{group:"edges",data:{id:"movement.7.attraction",source:"movement.6",target:"attraction.7"}},{group:"edges",data:{id:"balance.7.attraction",source:"balance.6",target:"attraction.7"}},{group:"edges",data:{id:"balance.7.balance",source:"balance.6",target:"balance.7"}},{group:"edges",data:{id:"resistance.7.balance",source:"resistance.6",target:"balance.7"}},{group:"edges",data:{id:"resistance.8.resistance",source:"resistance.7",target:"resistance.8"}},{group:"edges",data:{id:"resistance.8.balance",source:"resistance.7",target:"balance.8"}},{group:"edges",data:{id:"attraction.8.balance",source:"attraction.7",target:"balance.8"}},{group:"edges",data:{id:"attraction.8.attraction",source:"attraction.7",target:"attraction.8"}},{group:"edges",data:{id:"balance.8.attraction",source:"balance.7",target:"attraction.8"}},{group:"edges",data:{id:"balance.8.movement",source:"balance.7",target:"movement.8"}}],Ether.Engine=function(){var a=this;this.container=document.getElementById("container"),this.canvas=document.getElementById("canvas"),this.ctx=this.canvas.getContext("2d"),this.width=window.innerWidth,this.height=window.innerHeight,this.xv,this.yv,this.world=new Ether.World(this),this.hub=new Ether.Hub(this),this.util=new Ether.Util(this),this.audio=new Ether.Audio(this),this.upgrade=new Ether.Upgrade(this),this.ethers=[new Ether.Ether(a)],this.player=this.ethers[0],this.isPaused=!1,this.upgradeScreen=!1,this.gameOver=!1,this.gameOverAlpha=0,this.gameOverTime=0,this.awardDelay=-5e3,this.animate=function(b){if(requestAnimFrame(a.animate),!a.upgradeScreen)if(a.gameOver||(a.ctx.fillStyle="black",a.ctx.fillRect(0,0,a.width,a.height)),a.hub.intro)a.hub.drawIntro(b);else if(a.gameOver){if(a.gameOver){if(b>a.gameOverTime+100){a.gameOverAlpha+=.01,a.gameOverTime=b,a.ctx.fillStyle="rgba(255,255,255,+"+a.gameOverAlpha+");",a.ctx.fillRect(0,0,a.width,a.height),a.ctx.font="30px simple";var c=a.ctx.measureText("so it goes").width;a.ctx.fillStyle="black",a.ctx.fillText("so it goes",a.width/2-c/2,a.height/2)}a.hub.gameOver(a.ctx,b)}}else{a.world.draw(a,b),a.player.dying||a.checkAwards(b);for(var d=0;d<a.ethers.length;d++)a.ethers[d].draw(a,b);a.ctx.globalCompositeOperation="source-over",a.hub.draw(b)}}},Ether.Engine.prototype.init=function(){var a=this;this.canvas.width=this.width,this.canvas.height=this.height,this.ctx.fillStyle="rgba(0,0,0,0.3)",this.ctx.fillRect(0,0,this.width,this.height),this.player.init(),window.mobilecheck()?(this.canvas.addEventListener("touchstart",function(b){b.preventDefault(),a.world.handleTouch(b,a),a.hub.handleKeyDown()}),this.canvas.addEventListener("touchmove",function(b){b.preventDefault(),a.world.handleTouch(b,a),a.hub.handleKeyDown()})):(window.onkeydown=function(b){b.preventDefault(),a.world.handleKeyDown(b.keyCode,a),a.hub.handleKeyDown(),a.handleKeyDown(b.keyCode)},window.onkeyup=function(b){a.world.handleKeyUp(b.keyCode,a)}),this.hub.init(),this.world.init(this),this.audio.init(),this.upgrade.init(),this.setAwards(Ether.AwardType),window.requestAnimFrame(this.animate)},Ether.Engine.prototype.handleKeyDown=function(a){if(!this.hub.intro){var b=this.container.style.display;switch(a){case 85:"none"!=b?(this.container.style.display="none",this.upgrade.container.style.display="",this.upgrade.cy.forceRender(),this.upgradeScreen=!0):(this.container.style.display="",this.upgrade.container.style.display="none",this.upgradeScreen=!1);break;case 90:this.player.canZoom&&(this.player.zooming=!0)}}},Ether.Engine.prototype.checkAwards=function(a){if(!this.player.unstable){var b=this.player.getElementCount();if(a>this.awardDelay+5e3){this.awardLastTime=a;for(var c=0;c<this.awards.length;c++){var d=this.awards[c];if(!d.awarded){for(var e=["f","w","e","a"],f=0;f<e.length&&b[e[f]]>=d.amount;f++)f==e.length-1&&(d.awarded=!0,this.hub.newAward(d.text,d.award),this.player.receiveAward(d.award),this.awardDelay=a);break}}}}},Ether.Engine.prototype.setAwards=function(a){this.awards=Ether.awards[a];for(var b=1,c=1,d=0;d<this.awards.length;d++)this.awards[d].amount=b,this.awards[d].award=Math.ceil(c/2),b+=2,c=d+1},Ether.Engine.prototype.removeEther=function(a){for(var b=this.ethers.length;b>0;b--)if(this.ethers[b]&&this.ethers[b].x==a.x&&this.ethers[b].y==a.y)return void this.ethers.splice(b,1)};var e=new Ether.Engine;e.init();