'use strict';var Ether=Ether||{};
Ether.Element=function(b,c,d,f){d=d||{};this.type=d.type||b;this.bad=f;d.rgb=d.rgb||{};var h=d.rgb.r||255*Math.random()>>0,g=d.rgb.g||255*Math.random()>>0,k=d.rgb.b||255*Math.random()>>0;switch(b){case "core":150>=h&&(h+=100);150>=g&&(g+=100);150>=k&&(k+=100);break;case "fire":h=255;125<=g&&(g=75);100<=k&&(k=50);break;case "water":k=255;75<=h&&(h=50);175<=g&&(g-=100);break;case "air":185>=h&&(h=230);185>=g&&(g=230);k=255;break;case "earth":k=0;if(200<h||100>h)h=150;if(175<g||120>g)g=150}this.color=
"rgba("+h+","+g+","+k+",0.5)";this.rgb={r:h,g:g,b:k};c=c||0.5;this.radius=d.radius;if(!this.radius)switch(b){case "core":this.radius=15*Math.random()+5*c;default:this.radius=15*Math.random()+5*c}this.vx=10*Math.random()-5;this.vy=10*Math.random()-5;this.x;this.y;this.xOffset=d.xOffset;this.yOffset=d.yOffset;this.jitter=f?-5:-1};Ether.awards={};
Ether.awards.consciousness=[{text:"I"},{text:"I am"},{text:"Me"},{text:"Mine"},{text:"You"},{text:"I love"},{text:"I am sleepy"},{text:"I am hot"},{text:"I am cold"},{text:"I am thirsty"},{text:"I am hungry"},{text:"I am horny"},{text:"I am in the world"},{text:"I want this"},{text:"Why can't I have that?"},{text:"I'm afraid"},{text:"Why do I hurt?"},{text:"How do I get more?"},{text:"Who are my friends?"},{text:"How can I thrive?"},{text:"This is my stuff"},{text:"I am right"},{text:"They are wrong"},
{text:"I will create"},{text:"Will I die?"},{text:"Everything dies"},{text:"Why am I here?"},{text:"I will die"},{text:"Who am I?"},{text:"Where did I come from?"},{text:"This is the truth"},{text:"That is not the truth"},{text:"This is who I am"},{text:"Who I am keeps changing"},{text:"I am my thougts"},{text:"My thoughts always change"},{text:"Do I change?"},{text:"What is constant?"},{text:"I am awareness"},{text:"Was awareness always here?"},{text:"From here did this awareness come?"},{text:"All comes from nothing"},
{text:"All goes to nothing"},{text:"I am all"},{text:"I am nothing"},{text:"I am self evident"},{text:"I am self here"},{text:"No word is true"},{text:"How can sounds describe silence?"},{text:"[silence]"}];
Ether.awards.matter=[{text:"Strings(1 x 10^-35)"},{text:"Quantum Foam(1 x 10^-35)"},{text:"Neutrinos(1 x 10^-24)"},{text:"Quarks(1 x 10^-19)"},{text:"Protons(1 x 10^-15)"},{text:"Neutrons(1 x 10^-15)"},{text:"Electrons(1 x 10^-15)"},{text:"Rays(1 x 10^-12)"},{text:"Atoms(1 x 10^-10)"},{text:"Proteins(1 x 10^-10)"},{text:"Molecules(1 x 10^-9)"},{text:"Clay Particles(1 x 10^-6)"},{text:"Mist Droplets(1 x 10^-5)"},{text:"Viruses(1 x 10^-8)"},{text:"Large Rocks(5 x 10^3)"},{text:"Moons(1.5 x 10^5)"},
{text:"Bacteria(1 x 10^-3)"},{text:"Planets(1.27 x 10^7)"},{text:"Nebula(8^10 x 16)"},{text:"Protozoa(1 x 10^-5)"},{text:"Choanoflagellate(7 x 10^-6)"},{text:"Stars(5.8 x 10^9)"},{text:"Galaxies(1.2 x 10^21)"},{text:"Clusters(3 x 10^23)"},{text:"Chromistas(1 x 10^-1)"},{text:"Fungi(7 x 10^3)"},{text:"Invertebrates(4 x 10-2)"},{text:"Plants(1.5 x 10^1)"},{text:"Vertebrates(1 x 10^-1)"},{text:"Land Animals(3 x 10^0)"},{text:"Intelligence(1.7 x 10^0)"},{text:"Symbolic Systems(1.7 x 10^0)"},{text:"Mechanical Systems(1.5 x 10^1)"},
{text:"Digital Systems(3.2 x 10^-8)"},{text:"Bioengineered Systems(1.7 x 10^0)"},{text:"Quantum Systems(1 x 10^-10)"},{text:"Artifical Intelligence(3.2 x 10^-8)"},{text:"Planetary Societies(1.27 x 10^7)"},{text:"Synchronized Mind(1.7 x x10^0)"},{text:"Solar Societies(1.2 x 10^10)"},{text:"Giant Stars(8 x 10^11)"},{text:"Dwarf Stars(1.27 x 10^7)"},{text:"String Computing(1 x 10^-35)"},{text:"Neutron Stars(1.3 x 10^4)"},{text:"Supernovas(9.5 x 10^16)"},{text:"Galactic Societies(1.2 x 10^21)"},{text:"Multi-Demensional Computing(~)"},
{text:"Black Holes"},{text:"Thermal Equilibrium"},{text:"[silence]"}];Ether.Util=function(b){this.engine=b};Ether.Util.prototype.degToRad=function(b){return Ether.Util.radianInDeg*b};Ether.Util.prototype.radToDeg=function(b){return Ether.Util.degreeInRad*b};Ether.Util.radianInDeg=180/Math.PI;Ether.Util.degreeInRad=Math.PI/180;Ether.Util.prototype.getDistanceFromCenter=function(b,c){var d=c.x-Math.abs(b.x),f=c.y-Math.abs(b.y);return Math.sqrt(d*d+f*f)};
Ether.Util.prototype.createGradient=function(b,c){for(var d=0;d<c.length;d++){var f=c[d];b.addColorStop(f[0],f[1])}return b};Ether.Util.prototype.drawElement=function(b,c,d){d=d(c,b);c.fillStyle=d;c.arc(b.x,b.y,b.radius,2*Math.PI,!1);c.fill()};
Ether.Ether=function(b){this.engine=b;this.util=b.util;this.rotateLastTime=0;this.coreElements=[];this.elements=[];this.moved;this.x=b.width/2;this.y=b.height/2;this.xv;this.yv;this.range=15;this.mass=1;this.age=0;this.speed=8;this.health=5E3;this.lifeSpan=[100,95,90,70];this.currentSpan=this.lifeSpan[this.age];this.totalLifeSpan;this.dead=!1;this.ageLastTime=0;this.finalElementLength=1;this.stabilityLastTime=0;this.transformation;this.transformations=[this.rotateElement,this.createSludge];this.sludgeTimeOffset=
500;this.sludgeAlphaStep=0.1;this.rotateLastTime=this.sludgeLastTime=0;this.rotateDirection=-1;this.degreeChange=0};Ether.Ether.prototype.init=function(){switch(this.age){case 0:this.createCoreElement();break;case 1:case 2:this.zoomOut(2);break;case 3:this.zoomOut(2),this.sludgeAlphaStep*=2,this.sludgeTimeOffset*=4,this.finalElementLength=this.elements.length}};Ether.Ether.prototype.draw=function(b,c){this.drawCoreElements(b);this.drawElements(b,c);this.stabilityCheck(b,c)};
Ether.Ether.prototype.drawElements=function(b,c){var d=this;3==this.age&&this.ageEther(c);for(var f=0;f<this.elements.length;f++){var h=this.elements[f];h.x=this.x+h.xOffset+h.jitter*(this.getStability()/10);h.y=this.y+h.yOffset;h.jitter*=-1;2<=this.age&&this.transformation(h,c);b.ctx.beginPath();d.util.drawElement(h,b.ctx,function(c,f){var h=b.ctx.createRadialGradient(f.x,f.y,0,f.x,f.y,f.radius);return d.util.createGradient(h,[[0.1,"white"],[0.1,"white"],[0.8,f.color],[0.1,"black"]])})}2==this.age&&
c>this.rotateLastTime+500&&(this.rotateLastTime=c)};
Ether.Ether.prototype.drawCoreElements=function(b){var c=this;b.ctx.globalCompositeOperation="lighter";for(var d=0;d<this.coreElements.length;d++){var f=this.coreElements[d];b.ctx.beginPath();0==this.age?c.util.drawElement(f,b.ctx,function(b,d){var f=b.createRadialGradient(d.x,d.y,0,d.x,d.y,d.radius);return c.util.createGradient(f,[[0.5,"white"],[1,"black"]])}):c.util.drawElement(f,b.ctx,function(b,d){var f=b.createRadialGradient(d.x,d.y,0,d.x,d.y,d.radius);return c.util.createGradient(f,[[0.5,"white"],
[0.4,d.color],[1,"black"]])});f.x+=f.vx;f.y+=f.vy;this.getDistanceFromCenter(f)>this.range&&(f.x=this.x,f.y=this.y,this.vx=10*Math.random()-5,this.vy=10*Math.random()-5)}};Ether.Ether.prototype.stabilityCheck=function(b,c){var d=this.getStability();40<d&&3>this.age&&(b.hub.unstable=!0,50<=d&&c>this.stabilityLastTime+2E3-d&&(this.stabilityLastTime=c,this.loseElements(3)))};
Ether.Ether.prototype.zoomOut=function(b){this.range/=b;for(var c=0;c<this.elements.length;c++){var d=this.elements[c];d.radius/=b;d.xOffset/=b;d.yOffset/=b}for(c=0;c<this.coreElements.length;c++)this.coreElements[c].radius/=b};Ether.Ether.prototype.getDistanceFromCenter=function(b){return this.util.getDistanceFromCenter(this,b)};Ether.Ether.prototype.findDegree=function(b,c){var d=Math.acos(b/c);return this.util.radToDeg(d)};
Ether.Ether.prototype.ageEther=function(b){b>this.ageLastTime+this.healthRate(b)&&(this.ageLastTime=b,0!=this.elements.length&&this.loseElement(this.elements[this.elements.length-1],!0))};Ether.Ether.prototype.healthRate=function(b){this.totalLifeSpan||(this.totalLifeSpan=b+7E4);b=this.health+10*this.mass-(b-this.totalLifeSpan)-this.getStability();return 50<b?b:50};Ether.Ether.prototype.getStability=function(){var b=this.getElementCount(),c=b.f-b.w,b=b.a-b.e;return Math.floor(Math.sqrt(c*c+b*b))};
Ether.Ether.prototype.getElementCount=function(){for(var b=w=a=e=0,c=0;c<this.elements.length;c++){var d=this.elements[c];switch(d.type){case "fire":b+=Math.round(d.radius/5);break;case "water":w+=Math.round(d.radius/5);break;case "air":a+=Math.round(d.radius/5);break;case "earth":e+=Math.round(d.radius/5)}}c={};c.f=b;c.w=w;c.a=a;c.e=e;return c};
Ether.Ether.prototype.newElement=function(b){this.engine.audio.playSound(b);3!=this.age&&this.increaseMass(b);b.xOffset=b.x-this.x;b.yOffset=b.y-this.y;b.range=this.range;b.degree=this.findDegree(b.yOffset,this.getDistanceFromCenter(b));b.newElement=this.mass/2;this.elements.push(b)};
Ether.Ether.prototype.loseElement=function(b){this.decreaseMass(b);for(var c=0;c<this.elements.length;c++){var d=this.elements[c];if(d.x==b.x&&d.y==b.y)return b=this.elements.splice(c,1)[0],this.engine.world.newElement(b),!0}};Ether.Ether.prototype.loseElements=function(b){for(var c=0;c<b;c++)random=Math.floor(Math.random()*this.elements.length),0!=this.elements.length&&this.loseElement(this.elements[random],!0)};
Ether.Ether.prototype.createCoreElement=function(){var b=new Ether.Element("core");b.x=this.x;b.y=this.y;this.coreElements.push(b)};Ether.Ether.prototype.increaseMass=function(b){this.createCoreElement();this.mass+=1;this.range+=Math.round(b.radius/6)};Ether.Ether.prototype.decreaseMass=function(b){1<this.coreElements.length&&this.coreElements.pop();0<this.mass&&(this.mass-=1);2<this.range&&(this.range-=Math.round(b.radius/6))};
Ether.Ether.prototype.receiveAward=function(b){this.currentSpan=this.currentSpan+b>this.lifeSpan[this.age]?this.lifeSpan[this.age]:this.currentSpan+b};
Ether.Ether.prototype.rotateElement=function(b,c){c>this.rotateLastTime+500&&(0>this.rotateDirection?(this.degreeChange+=0.0010,1<this.degreeChange&&(this.degreeChange=1),this.currentSpan<this.lifeSpan[this.age]/3*2&&this.rotateDirection++):0<this.rotateDirection?(this.degreeChange-=0.0010,0.0010>this.degreeChange&&(this.degreeChange=0.0010)):this.currentSpan<this.lifeSpan[this.age]/3&&this.rotateDirection++);b.degree=360==b.degree?0:b.degree+this.degreeChange;b.xOffset=b.range*Math.cos(this.util.degToRad(b.degree));
b.yOffset=b.xOffset*Math.tan(this.util.degToRad(b.degree))};Ether.Ether.prototype.createSludge=function(b,c){if(c>this.sludgeLastTime+this.sludgeTimeOffset){this.sludgeLastTime=c;for(var d=new Sludge(this.engine,this),f=0;f<this.elements.length;f++)b=this.elements[f],0<this.xv&&b.x>this.x?this.pushSludge(d,b):0>this.xv&&b.x<this.x?this.pushSludge(d,b):0<this.yv&&b.y>this.y?this.pushSludge(d,b):0>this.yv&&b.y<this.y&&this.pushSludge(d,b);this.engine.ethers.push(d)}};
Ether.Ether.prototype.pushSludge=function(b,c){var d=new Ether.Element(0,0,c);b.elements.push(d)};
Sludge=function(b,c){var d=this;this.engine=b;this.world=b.world;this.player=c;this.elements=[];this.alpha=0.5;this.nTime=this.alphaTime=0;this.x=c.x;this.y=c.y;this.xOffset=this.x-this.world.x;this.yOffset=this.y-this.world.y;this.draw=function(b,c){d.x=this.world.x+this.xOffset;d.y=this.world.y+this.yOffset;if(c>d.alphaTime+200){d.alphaTime=c;if(0==d.alpha){d.destroy();return}d.alpha-=this.player.sludgeAlphaStep;0>d.alpha&&(d.alpha=0)}for(var g=0;g<d.elements.length;g++){var k=d.elements[g];c>d.nTime+
50&&(g==d.elements.length-1&&(d.nTime=c),k.radius+=1);k.x=d.x+k.xOffset;k.y=d.y+k.yOffset;k.x>-(k.radius+3)&&k.x<b.width+k.radius+3&&k.y>-(k.radius+3)&&k.y<b.height+k.radius+3&&(b.ctx.beginPath(),d.engine.util.drawElement(k,b.ctx,function(b,c){return"rgba("+c.rgb.r+","+c.rgb.g+","+c.rgb.b+","+d.alpha+")"}))}};this.destroy=function(){d.engine.removeEther(d)}};
Ether.World=function(b){this.engine=b;this.util;this.player;this.width=30*b.width;this.height=30*b.height;this.x=b.width/2;this.y=b.height/2;this.dragLastTime=this.yv=this.xv=0;this.speedUp={};this.speedUp.x=!1;this.speedUp.y=!1;this.fire=[];this.water=[];this.earth=[];this.air=[];this.elements=[this.earth,this.air,this.fire,this.water];this.driftArray=[];this.sizeOffset=5E3;this.hills=[];this.hillWidthAmount=4;this.hillHeightAmount=2;this.hillWidth=b.width/this.hillWidthAmount;this.hillHeight=b.height/
this.hillHeightAmount};
Ether.World.prototype.init=function(b){var c=["earth","air","fire","water"];0!=b.ethers[0].age?this.zoomOut(2):(this.player=b.ethers[0],this.util=b.util);this.initBackground();for(var d=0;d<this.elements.length;d++){var f=this.elements[d];f.length=0;var h=c[d];switch(b.ethers[0].age){case 0:this.initElements(h,f,[5,300],[0,200],[300,50],[9E3,100]);this.initBadGuys(h,f,120,!0);break;case 1:this.initElements(h,f,[70,200],[10,180],[250,50],[7E3,2E3]);break;case 2:this.initElements(h,f,[],[20,80],[200,
200],[5E3,1E3]);this.initBadGuys(h,f,60);break;case 3:this.initElements(h,f,[0],[50],[300],[6E3]),this.initBadGuys(h,f,30)}}};Ether.World.prototype.initElements=function(b,c,d,f,h,g){for(var k=0;k<h.length;k++)this.initElement(b,c,h[k],g[k],function(b){f[k]&&b.radius>f[k]&&(b.radius=f[k]);d[k]&&b.radius<d[k]&&(b.radius=d[k])})};Ether.World.prototype.initBadGuys=function(b,c,d,f){(f||this.engine.badGuys)&&this.initElement(b,c,25,100,function(b){b.radius>d&&(b.radius=d)},!0)};
Ether.World.prototype.initElement=function(b,c,d,f,h,g){for(var k=0;k<d;k++){var m=(2*Math.random()*this.width-this.width)/2,n=(2*Math.random()*this.height-this.height)/2,l=this.getDistanceFromCenter({x:m,y:n}),l=new Ether.Element(b,l/f,{},g);h(l);l.xOffset=m;l.yOffset=n;c.push(l)}};Ether.World.prototype.initBackground=function(){for(var b=0;b<this.hillHeightAmount+2;b++){for(var c=[],d=0;d<this.hillWidthAmount+2;d++)c[d]={x:this.hillWidth*d,y:this.hillHeight*b};this.hills.push(c)}};
Ether.World.prototype.draw=function(b,c){this.xv=this.adjustVelocity("x",this.xv,c);this.yv=this.adjustVelocity("y",this.yv,c);c>this.dragLastTime+200&&(this.dragLastTime=c);this.drawBackground(this.xv,this.yv);this.x+=this.xv;this.y+=this.yv;this.player.xv=this.xv;this.player.yv=this.yv;b.xv=this.xv;b.yv=this.yv;for(var d=0;d<this.elements.length;d++)for(var f=this.elements[d],h=0;h<f.length;h++){var g=f[h];if(this.isInView(g)){g.jitter*=-1;g.x=this.x+g.xOffset+g.jitter;g.y=this.y+g.yOffset;this.driftTowardsEther(g);
b.ctx.beginPath();var k=b.ctx.createRadialGradient(g.x,g.y,0,g.x,g.y,g.radius);g.bad?this.util.createGradient(k,[[0.1,"rgba("+Math.round(255*Math.random())+","+Math.round(255*Math.random())+","+Math.round(255*Math.random())+",1)"],[0.3,"black"],[0.7,"black"],[0.9,"rgba("+Math.round(255*Math.random())+","+Math.round(255*Math.random())+","+Math.round(255*Math.random())+",1)"]]):this.util.createGradient(k,[[0.1,"white"],[0.1,"white"],[0.8,g.color],[0.1,"black"]]);b.ctx.fillStyle=k;b.ctx.arc(g.x,g.y,
g.radius,2*Math.PI,!1);b.ctx.fill();this.isInRangeOfEther(g,d,h)}}this.drawDriftingElements(b);this.drawBorder(b)};Ether.World.prototype.zoomOut=function(b){this.hillHeightAmount*=b;this.hillWidthAmount*=b;this.hillWidth=this.engine.width/this.hillWidthAmount;this.hillHeight=this.engine.height/this.hillHeightAmount};
Ether.World.prototype.drawBackground=function(b,c){for(var d=0;d<this.hills.length;d++)for(var f=this.hills[d],h=0;h<f.length;h++){var g=f[h];g.x+=b;g.y+=c;0>g.x+this.hillWidth&&(g.x=this.engine.width);g.x>this.engine.width&&(g.x=-this.hillWidth);0>g.y+this.hillHeight&&(g.y=this.engine.height);g.y>this.engine.height&&(g.y=-this.hillHeight);var k=this.engine.ctx.createLinearGradient(g.x,g.y,g.x+this.hillWidth,g.y+this.hillHeight);this.engine.ctx.fillStyle=this.util.createGradient(k,[[0.05,"rgba(0,0,0,1)"],
[0.95,"rgba(20,20,20,1)"]]);this.engine.ctx.fillRect(g.x,g.y,this.hillWidth+5,this.hillHeight+5)}};
Ether.World.prototype.driftTowardsEther=function(b){var c=this.player,d=40>b.radius?20*b.radius:2*b.radius,f;f=b.bad?c.speed-2:50<b.radius?b.radius/50:b.radius/5;if(b.bad||this.util.getDistanceFromCenter(b,c)<=d)for(var h;!h;)switch(Math.floor(4*Math.random())){case 0:b.x<c.x+5&&(b.xOffset+=f,h=!0);break;case 1:b.x>c.x-5&&(b.xOffset-=f,h=!0);break;case 2:b.y<c.y+5&&(b.yOffset+=f,h=!0);break;case 3:b.y>c.y-5&&(b.yOffset-=f,h=!0)}};
Ether.World.prototype.removeBadElements=function(){for(var b=0;b<this.elements.length;b++)for(var c=this.elements[b],d=0;d<c.length;d+=1)c[d].bad&&(c.splice(d,1),d-=1)};Ether.World.prototype.drawBorder=function(b){b.ctx.fillStyle="white";this.borderX=this.x-this.width/2;this.borderY=this.y-this.height/2;this.borderW=this.width;this.borderH=this.height;b.ctx.strokeRect(this.borderX,this.borderY,this.borderW,this.borderH)};
Ether.World.prototype.drawDriftingElements=function(b){for(var c=0;c<this.driftArray.length;c++){var d=this.driftArray[c];d.xOffset+=d.jitter*d.radius/2;var f=this.x+d.xOffset,h=this.y+d.yOffset;b.ctx.beginPath();var g=b.ctx.createRadialGradient(f,h,0,f,h,d.radius);b.ctx.fillStyle=this.util.createGradient(g,[[0.1,"white"],[0.1,"white"],[0.8,d.color],[0.1,"black"]]);b.ctx.arc(f,h,d.radius,2*Math.PI,!1);b.ctx.fill();d.newElement?d.newElement--:(f="earth"==d.type?0:"air"==d.type?1:"fire"==d.type?2:"water"==
d.type?3:void 0,d.jitter/=5,this.driftArray.splice(c,1),c--,this.elements[f].push(d))}};Ether.World.prototype.isInRangeOfEther=function(b,c,d){if(this.isInView(b)){var f=this.player,h=f.range+b.radius/2,g=b.xOffset+this.x,k=b.yOffset+this.y;f.getDistanceFromCenter({x:g,y:k})<h&&(b.bad?(this.engine.audio.playSound(b),f.loseElements(1),6<f.elements.length&&f.tripleLoss()):(b.x=g,b.y=k,f.newElement(b),this.elements[c].splice(d,1)))}};
Ether.World.prototype.isInView=function(b){var c=b.xOffset+this.x,d=b.yOffset+this.y;if(c>-b.radius&&c<this.engine.width+b.radius&&d>-b.radius&&d<this.engine.height+b.radius)return!0};Ether.World.prototype.getDistanceFromCenter=function(b){return this.engine.util.getDistanceFromCenter(b,this)};
Ether.World.prototype.adjustVelocity=function(b,c,d){d>this.dragLastTime+200&&(this.speedUp[b]?0<c&&c<=this.player.speed?(c+=2,c>this.player.speed&&(c=this.player.speed)):0>c&&c>=-this.player.speed&&(c-=2,c<-this.player.speed&&(c=-this.player.speed)):0!=c&&(0<c?(c-=2,0>c&&(c=0)):0>c&&(c+=2,0<c&&(c=0))));return c};
Ether.World.prototype.handleKeyDown=function(b){switch(b){case 87:case 38:!this.speedUp.y&&-5<=this.yv?(this.speedUp.y=!0,this.yv=1):-5>this.yv&&(this.speedUp.y=!1);this.player.moved=!0;break;case 68:case 39:!this.speedUp.x&&5>=this.xv?(this.speedUp.x=!0,this.xv=-1):5<this.xv&&(this.speedUp.x=!1);this.player.moved=!0;break;case 83:case 40:!this.speedUp.y&&5>=this.yv?(this.speedUp.y=!0,this.yv=-1):5<this.yv&&(this.speedUp.y=!1);this.player.moved=!0;break;case 65:case 37:!this.speedUp.x&&-5<=this.xv?
(this.speedUp.x=!0,this.xv=1):-5>this.xv&&(this.speedUp.x=!1),this.player.moved=!0}};Ether.World.prototype.handleKeyUp=function(b){switch(b){case 38:this.speedUp.y=!1;break;case 39:this.speedUp.x=!1;break;case 40:this.speedUp.y=!1;break;case 37:this.speedUp.x=!1}};Ether.World.prototype.newElement=function(b){var c=this.player;b.xOffset=b.x-this.x;b.yOffset=b.y-this.y;b.newElement=10;b.jitter*=4;if(b.x<c.x&&0<b.jitter||b.x>c.x&&0>b.jitter)b.jitter*=-1;this.driftArray.push(b)};
Ether.Hub=function(b){var c=this;this.engine=b;this.unit=b.width/50;this.showInfo=!0;this.lastTime=0;this.messageExist=!1;this.messageAlpha=1;this.currentMessage="";this.lastMessageTime=0;this.betweenAlpha=0.1;this.betweenLastTime=0;this.intro=!0;this.introAlpha=this.lastIntroTime=0;this.introText=";an ether is born;you are born;collect the four elements;grow into yourself;and die;as all things that are born must;seek balance".split(";");this.timeOffset=this.introIndex=0;this.choice2Alpha=this.choice1Alpha=
0.2;this.question=0;this.lifeStageMssg=this.awardMssg="";this.lifeStageOpts=["spread your wings","spread your trail"];this.gameOverAlpha=this.gameOverLastTime=0;this.gameOverWidth;this.gameOverColor="rgba(255,255,255,";this.mousemove=function(b){var f=b.x;c.gameOverWidth?c.gameOverColor="rgba(255,0,0,"!=c.gameOverColor&&b.x>c.engine.width-2*c.gameOverWidth&&b.y>c.engine.height-2*c.gameOverWidth?"rgba(255,0,0,":"rgba(255,255,255,":f<=c.engine.width/2?(c.choice1Alpha=0.5,c.choice2Alpha=0.2):(c.choice1Alpha=
0.2,c.choice2Alpha=0.5)};this.handleClick=function(b){if(c.gameOverWidth)b.x>c.engine.width-2*c.gameOverWidth&&b.y>c.engine.height-2*c.gameOverWidth&&(window.location.href="index.html");else{switch(c.question){case 0:c.showInfo=c.choice1Alpha>c.choice2Alpha?!0:!1;break;case 1:c.choice1Alpha>c.choice2Alpha?c.engine.setAwards("matter"):c.engine.setAwards("consciousness");break;case 2:b=c.engine.ethers[0];b.transformation=c.choice1Alpha>c.choice2Alpha?b.transformations[0]:b.transformations[1];c.lifeStageMssg=
c.choice1Alpha>c.choice2Alpha?c.lifeStageOpts[0]:c.lifeStageOpts[1];break;case 3:c.engine.badGuys=c.choice1Alpha>c.choice2Alpha?!0:!1,c.engine.badGuys||c.engine.world.removeBadElements()}3<c.question&&c.introIndex+1<c.introText.length?(c.timeOffset=c.lastIntroTime,c.introIndex++,c.introIndex!=c.introText.length-1&&(c.introAlpha=0)):c.introIndex+1!=c.introText.length&&(c.question++,c.introAlpha=0)}};this.handleKeyDown=function(){3<c.question&&c.introIndex+1<c.introText.length&&(c.timeOffset=c.lastIntroTime,
c.introIndex++,c.introIndex!=c.introText.length-1&&(c.introAlpha=0))}};Ether.Hub.prototype.init=function(){window.onmousemove=this.mousemove;window.onclick=this.handleClick};Ether.Hub.prototype.drawIntro=function(b){var c=this.engine.ctx;3>=this.question?(this.drawAnswerBoxes(c,b),this.drawQuestionText(c,b)):this.drawIntroText(c,b)};
Ether.Hub.prototype.drawIntroText=function(b,c){c>this.lastIntroTime+50&&(this.introAlpha+=0.1,this.lastIntroTime=c,1<this.introAlpha&&(this.introAlpha=1),3E3<this.lastIntroTime-this.timeOffset&&(this.timeOffset=this.lastIntroTime,this.introAlpha=0,this.introIndex++,this.introIndex==this.introText.length&&(this.intro=!1)));var d=this.introText[this.introIndex],f=b.measureText(d).width;b.fillStyle="rgba(255,255,255,"+this.introAlpha+")";b.fillText(d,this.engine.width/2-f/2,this.engine.height/2)};
Ether.Hub.prototype.drawQuestionText=function(b,c){var d=["Which is more true?","To which are you destined?","Which is your body?","Which do you desire?"][this.question],f=[["Knowledge is Power.","Reality is Unknown."],["Matter","Consciousness"],["A Butterfly","A Snail"],["Struggle","Peace"]][this.question],h=b.measureText(d).width;c>this.lastIntroTime+50&&(this.lastIntroTime=c,this.introAlpha+=0.05,1<this.introAlpha&&(this.introAlpha=1));b.font="28pt Titillium Web";b.fillStyle="rgba(164,161,151,"+
this.introAlpha+")";b.fillText(d,this.engine.width/2-h/2,2*this.unit);d=b.measureText(f[0]).width;h=b.measureText(f[1]).width;b.fillText(f[0],this.engine.width/4-d/2,this.engine.height/2);b.fillText(f[1],this.engine.width/4*3-h/2,this.engine.height/2)};Ether.Hub.prototype.drawAnswerBoxes=function(b){var c=this.engine.width,d=this.engine.height;b.fillStyle="rgba(75,100,75,"+this.choice1Alpha+")";b.fillRect(0,0,c/2,d);b.fillStyle="rgba(75,75,100,"+this.choice2Alpha+")";b.fillRect(c/2,0,c/2,d)};
Ether.Hub.prototype.draw=function(b){var c=this.getStats(),d=this.engine.ctx,f=100<c.stab?0:100-c.stab;this.showInfo&&(d.font=this.unit+"30px Titillium Web",d.fillStyle="rgba(164,161,151,1)",d.fillText("Mass: "+Math.floor(c.mass),this.unit,1.5*this.unit),d.fillText("Balance: "+f,this.unit,2.5*this.unit));this.drawInbetween(d,b);this.showInfo&&this.drawElementStats(c.elementCount,d);this.drawLifeBar(d,b);this.drawMessage(d,b)};
Ether.Hub.prototype.drawInbetween=function(b,c){var d=this.engine.ethers[0].age;this.engine.betweenAges&&(3>d?c>this.betweenLastTime+100&&(this.betweenLastTime=c,b.fillStyle="rgba(164,161,151,"+this.betweenAlpha+")",b.fillRect(0,0,this.engine.width,this.engine.height)):this.gameOver(b,c))};Ether.Hub.prototype.newAward=function(b){this.awardMssg=b;this.drawMessage(0,0,!0)};
Ether.Hub.prototype.getStats=function(){var b={},c=this.engine.ethers[0];b.mass=c.mass;b.stab=c.getStability();b.elementCount=c.getElementCount();b.range=c.range;return b};
Ether.Hub.prototype.drawElementStats=function(b,c){c.font=this.unit/2+"px Titillium Web";c.fillStyle="red";c.fillText("Fire: "+b.f,this.unit,3.2*this.unit);c.fillStyle="blue";c.fillText("Water: "+b.w,3.5*this.unit,3.2*this.unit);c.fillStyle="white";c.fillText("Air: "+b.a,this.unit,4.1*this.unit);c.fillStyle="green";c.fillText("Earth: "+b.e,3.5*this.unit,4.1*this.unit)};
Ether.Hub.prototype.drawLifeBar=function(b,c){if(!this.engine.betweenAges){var d=this.engine.ethers[0],f=3!=d.age?d.currentSpan/d.lifeSpan[d.age]:d.elements.length/d.finalElementLength;b.fillStyle=["green","yellow","orange","red"][d.age];b.fillRect(this.engine.width-0.5*this.unit,1.5*this.unit,-(5*this.unit)*f,0.5*this.unit);b.strokeStyle="red";b.strokeRect(this.engine.width-5.5*this.unit,1.5*this.unit,5*this.unit,0.5*this.unit);d.moved&&c>this.lastTime+1E3&&!d.inVoid&&(this.lastTime=c,0<f?d.currentSpan--:
(this.engine.betweenAges=!0,this.messageExist=!1))}};
Ether.Hub.prototype.drawMessage=function(b,c,d){var f=this.engine.ethers[0];d&&!this.engine.betweenAges&&(this.messageExist=!1,this.messageAlpha=1);if(this.messageExist)d||this.renderMessage(b,c);else if(this.engine.betweenAges)switch(this.messageExist=!0,f.age){case 0:this.currentMessage="you are no longer an infant";break;case 1:this.currentMessage=this.lifeStageMssg;break;case 2:this.currentMessage="give back you borrowed";break;case 3:this.currentMessage="so it goes"}else this.awardMssg?(this.messageExist=
!0,this.currentMessage=this.awardMssg):this.hasLeftBorder()&&"there is no time in the boundless void"!=this.currentMessage?(this.messageExist=!0,this.currentMessage="there is no time in the boundless void"):this.killerElement?(this.messageExist=!0,this.currentMessage="Save The Big Ones For Post-Infancy"):this.unstable&&!this.stableWarned&&(this.stableWarned=this.messageExist=!0,this.currentMessage="You Are Becoming Too Unstable")};
Ether.Hub.prototype.renderMessage=function(b,c){b.font=this.currentMessage==this.awardMssg?"90px Titillium Web":"30px Titillium Web";var d=b.measureText(this.currentMessage).width;d>this.engine.width-10&&(b.font="70px Titillium Web",d=b.measureText(this.currentMessage).width);var d=this.engine.width/2-d/2,f=this.engine.height/2-this.unit;b.fillStyle="rgba(0,0,0,"+this.messageAlpha+")";b.fillText(this.currentMessage,d+2,f+2);b.fillStyle="rgba(164,161,151,"+this.messageAlpha+")";b.fillText(this.currentMessage,
d,f);c>this.lastMessageTime+100&&(this.messageAlpha-=0.01,0.01>=this.messageAlpha&&(this.messageExist=!1,this.messageAlpha=1,this.awardMssg="",this.killerElement=!1,this.engine.betweenAges&&!this.engine.ethers[0].dead&&(this.currentMessage="",this.engine.betweenAges=!1,this.engine.ethers[0].age++,this.engine.ethers[0].currentSpan=this.engine.ethers[0].lifeSpan[this.engine.ethers[0].age],4>this.engine.ethers[0].age&&this.engine.init())),this.lastMessageTime=c)};
Ether.Hub.prototype.hasLeftBorder=function(){var b=this.engine.ethers[0],c=this.engine.world;if(b.x<=c.borderX||b.y<=c.borderY||b.x>=c.vorderX+c.borderW||b.y>=c.borderY+c.borderH)return b.inVoid=!0;b.inVoid=!1};
Ether.Hub.prototype.gameOver=function(b,c){c>this.gameOverLastTime+100&&1!=this.gameOverAlpha&&(this.gameOverAlpha+=0.02,1<this.gameOverAlpha&&(this.gameOverAlpha=1));b.fillStyle=this.gameOverColor+this.gameOverAlpha+")";b.font="1em Courier";this.gameOverWidth=b.measureText("Restart").width;b.fillText("Restart",this.engine.width-1.5*this.gameOverWidth,this.engine.height-10)};Ether.Audio=function(b){this.engine;this.ctx;this.audio={}};Ether.Audio.prototype.init=function(){this.loadSounds()};
Ether.Audio.prototype.loadSounds=function(b){var c=["fire","water","air","earth"];b=b||0;var d=c[b];this.audio[d]=new Audio("audio/"+d+".wav");b!=c.length-1?(b++,this.loadSounds(b)):this.loaded=!0};Ether.Audio.prototype.playSound=function(b){var c=b.bad?1:b.radius/125;1<c&&(c=1);this.audio[b.type].volume=c;this.audio[b.type].play()};
Ether.Engine=function(){var b=this;this.canvas=document.getElementById("canvas");this.ctx=this.canvas.getContext("2d");this.width=window.innerWidth;this.height=window.innerHeight;this.xv;this.yv;this.world=new Ether.World(this);this.hub=new Ether.Hub(this);this.util=new Ether.Util(this);this.audio=new Ether.Audio(this);this.ethers=[new Ether.Ether(b)];this.player=this.ethers[0];this.betweenAges=!1;this.gameOverTime=this.gameOverAlpha=0;this.awardDelay=-5E3;this.animate=function(c){requestAnimFrame(b.animate);
b.player.dead||(b.ctx.fillStyle="black",b.ctx.fillRect(0,0,b.width,b.height));if(b.hub.intro)b.hub.drawIntro(c);else if(b.betweenAges)b.hub.draw(c);else if(b.player.dead)b.player.dead&&c>b.gameOverTime+100&&(b.gameOverAlpha+=0.01,b.gameOverTime=c,b.ctx.fillStyle="rgba(255,255,255,+"+b.gameOverAlpha+");",b.ctx.fillRect(0,0,b.width,b.height),b.ctx.font="30px Arial",b.ctx.fillStyle="black",b.ctx.fillText("Dead",b.width/2,b.height/2));else{b.world.draw(b,c);b.player.dying||b.checkAwards(c);for(var d=
0;d<b.ethers.length;d++)b.ethers[d].draw(b,c);b.ctx.globalCompositeOperation="source-over";b.hub.draw(c)}}};
Ether.Engine.prototype.init=function(){var b=this;this.canvas.width=this.width;this.canvas.height=this.height;this.ctx.fillStyle="rgba(0,0,0,0.3)";this.ctx.fillRect(0,0,this.width,this.height);this.player.init();window.onkeydown=function(c){b.world.handleKeyDown(c.keyCode,b);b.hub.handleKeyDown()};window.onkeyup=function(c){b.world.handleKeyUp(c.keyCode,b)};this.hub.init();this.world.init(this);this.audio.init();0==this.player.age&&window.requestAnimFrame(this.animate)};
Ether.Engine.prototype.checkAwards=function(b){var c=this.player.getElementCount();if(b>this.awardDelay+5E3){this.awardLastTime=b;for(var d=0;d<this.awards.length;d++){var f=this.awards[d];if(!f.awarded){for(var d=["f","w","e","a"],h=0;h<d.length;h++)if(c[d[h]]>=f.amount)h==d.length-1&&(f.awarded=!0,this.hub.newAward(f.text),this.player.receiveAward(f.award),this.awardDelay=b);else break;break}}}};
Ether.Engine.prototype.setAwards=function(b){this.awards=Ether.awards[b];for(var c=b=1,d=0;d<this.awards.length;d++)this.awards[d].amount=b,this.awards[d].award=Math.ceil(c/5),console.log(d),b+=3,c=d+1};Ether.Engine.prototype.removeEther=function(b){for(var c=this.ethers.length;0<c;c--)if(this.ethers[c]&&this.ethers[c].x==b.x&&this.ethers[c].y==b.y){this.ethers.splice(c,1);break}};var e=new Ether.Engine;e.init();
